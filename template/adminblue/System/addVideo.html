{extend name="adminblue/base" /}
{block name="resources"/}
<link rel="stylesheet" type="text/css" href="ADMIN_CSS/defau.css">
<style type="text/css">
    /* 展示视频 */
    .video-thumb{display: block !important;float: left;//width: 400px !important;height: 164px !important;position: relative;}
    .video-thumb span{width:10px;height:10px;cursor:pointer;position:absolute;right:10px;top:10px;background-image:url('__STATIC__/blue/img/close.jpg');background-size:100%;}
</style>
{/block}
{block name="main"}
<div class="set-style">
    <dl>
        <dt>名称：</dt>
        <dd>
            <input id="video_name" type="text" value="{$videoDetail.video_name}" class="input-common" />
        </dd>
    </dl>
    <dl>
        <dt>视频：</dt>
        <dd>
            <div class="controls" style="background-color:#FFF;border: 1px solid #E9E9E9;">
                <div class="ncsc-goods-default-pic">
                    <div class="goodspic-uplaod" style="padding: 15px;">
                        <div style="min-height:120px;">
                            <div class="video-thumb" >
                                <video id="my-video" controls {if condition="empty($videoDetail['video_address'])"}poster="__STATIC__/blue/img/vs.png"  {else/} poster=""  {/if} preload="auto"  style="max-width:100%;max-height:100%;width:auto;height:auto;">
                                <source src="{:__IMG($videoDetail.video_address)}" type="video/mp4" id="video-source">
                                </video>
                                <span class="del-video {if condition='empty($videoDetail.video_address)'} hide {/if}" onclick="del_video()"></span>
                            </div>
                        </div>
                        <div class="clear"></div>
                        <div class="handle">
                            <div class="ncsc-upload-btn" id="video-file-box">
                                <a href="javascript:void(0);">
									<span>
										<input class="input-file" name="file_upload" id="videoupload" type="file" onchange="fileUpload_video(this);">
									</span>
                                    <p>上传视频</p>
                                    <input type="hidden" id="video_url" value="{$videoDetail.video_address}">
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </dd>
    </dl>
    <dl>
        <dt></dt>
        <dd><button class="btn-common btn-big" onclick="addVideoAjax();">提交</button></dd>
        <input type="hidden" id="video_id" value="{$videoDetail.video_id}">
    </dl>
</div>
<script src="__STATIC__/js/ajax_file_upload.js" type="text/javascript"></script>
<script src="__STATIC__/js/file_upload.js" type="text/javascript"></script>
<script>
    /**
     * 文件上传（视频、音频）
     */
    function fileUpload_video(event) {
        var fileid = $(event).attr("id");
        var data = { 'file_path' : UPLOADGOODSVIDEO };
        var dom = document.getElementById(fileid);
        var file =  dom.files[0];//File对象;
        var fileTypeArr = ['video/mp4','video/3gp','video/avi','video/rmvb','video/rm',];
        var flag = false;
        if(file != null){
            for(var i=0;i<fileTypeArr.length;i++){
                if(file.type == fileTypeArr[i]){
                    flag = true;
                    break;
                }
            }
        }
        if(!flag){
            showTip("文件类型不合法","warning");
        }else{
            uploadFile(fileid,data,function(res){
                if(res.code){
                    $("#video_url").val(res['data']);
                    $("#my-video").attr('poster','');
                    $("#my-video").attr('src',__IMG(res['data']));
                    $(".del-video").show();
                    showTip(res.message,"success");
                }else{
                    showTip(res.message,"error");
                }
            });
        }
    }

    /**
     * 删除已选择的视频
     */
    function del_video(){

        // 通过ajax用php删除文件
        var src = $("#video_url").val();
        if(src!= ""){

            $("#my-video ").attr('src', "");
            $("#my-video").attr('poster','__STATIC__/blue/img/vs.png');
            $("#videoupload").val('');
            $(".del-video").hide();
            $("#video_url").val('');
            /* $.ajax({
             type : "post",
             url : "{:__URL('ADMIN_MAIN/goods/delSelectedVideo')}",
             data : {
             'src':src,
             },
             success : function(res){
             //console.log(res);
             }
             }); */

        }


    }

    function addVideoAjax(){
        var video_id = $("#video_id").val();
        var video_name = $("#video_name").val();
        var video_address = $("#video_url").val();
        $.ajax({
            type:"post",
            url : "{:__URL('ADMIN_MAIN/system/addVideo')}",
            data : {
                "video_id" : video_id,
                "video_name" : video_name,
                "video_address" : video_address
            },
            success : function(data){
                if(data['code'] > 0){
                    showMessage('success', data["message"]);
                    location.href=__URL("ADMIN_MAIN/system/addVideo");
                }else{
                    showMessage('error', data["message"]);
                }
            }
        })
    }
</script>
{/block}
{extend name="adminblue/base" /}
{block name="resources"/}
<link rel="stylesheet" type="text/css" href="ADMIN_CSS/product.css">
<script type="text/javascript" src="__STATIC__/My97DatePicker/WdatePicker.js"></script>
<style type="text/css">
    #productTbody td {
        border: 0;
        padding: 5px;
    }

    .tr-title td {
        background: #e4f2ff !important;
    }

    .table-title th {
        padding: 10px;
        border-bottom: 1px solid #e5e5e5;
        font-weight: normal;
        background: #F3F1F1 !important;
    }

    .a-pro-view-img {
        float: left;
    }

    .thumbnail-img {
        width: 60px;
        margin-right: 10px;
    }

    .cell i {
        display: block;
    }

    .remodal-bg.with-red-theme.remodal-is-opening, .remodal-bg.with-red-theme.remodal-is-opened {
        filter: none;
    }

    .remodal-overlay.with-red-theme {
        background-color: #f44336;
    }

    .remodal.with-red-theme {
        background: #fff;
    }

    input[type="radio"], input[type="checkbox"] {
        margin: -1px 5px 0 0;
    }

    .edit-group {
        border-bottom: 1px solid #ebebeb;
        margin-bottom: 10px;
    }

    .edit-group label {
        font-weight: normal;
    }

    .edit-group-title {
        height: 15px;
        line-height: 15px;
        width: 140px;
        margin-top: 3px;
        margin-bottom: 3px;
        color: #0072D2;
    }

    .edit-group-button {
        border-color: #3283fa;
        border: 1px solid #bbb;
        height: 26px;
        line-height: 24px;
        padding: 0 5px;
    }

    .group-button-bg {
        background: #3283fa;
        color: #fff;
    }

    .div-pro-view-name {
        width: 100%;
        min-height: 60px;
    }

    i.hot, i.recommend, i.new, i.sale_type {
        font-size: 12px;
        margin-right: 5px;
        font-style: normal;
        color: #fff;
        background-color: #E84C3D;
        border-radius: 2px;
        padding: 1px 2px;
        position: relative;
        top: -5px;
    }

    i.black_tech {
        font-size: 12px;
        margin-right: 5px;
        font-style: normal;
        color: #fff;
        background-color: black;
        border-radius: 2px;
        padding: 1px 2px;
        position: relative;
        top: -5px;
    }

    .icon-qrcode:before {
        content: "\f029";
    }

    [class^="icon-"]:before, [class*=" icon-"]:before {
        text-decoration: inherit;
        display: inline-block;
        speak: none;
    }

    [class^="icon-"], [class*=" icon-"] {
        font-family: FontAwesome;
        font-weight: normal;
        font-style: normal;
        text-decoration: inherit;
        -webkit-font-smoothing: antialiased;
    }

    .goodsCategory {
        width: 159px;
        height: 300px;
        border: 1px solid #CCCCCC;
        position: absolute;
        z-index: 100;
        background: #fff;
        right: 0;
        display: none;
        overflow-y: auto;
        top: 31px;
    }

    .goodsCategory::-webkit-scrollbar {
        width: 3px;
    }

    .goodsCategory::-webkit-scrollbar-track {
        -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, .3);
        border-radius: 10px;
        background-color: #fff;
    }

    .goodsCategory::-webkit-scrollbar-thumb {
        height: 20px;
        border-radius: 10px;
        -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, .3);
        background-color: #ccc;
    }

    .goodsCategory ul {
        height: 280px;
        margin-top: -2px;
        margin-left: 0;
    }

    .goodsCategory ul li {
        text-align: left;
        padding: 0 10px;
        line-height: 30px;
    }

    .goodsCategory ul li i {
        float: right;
        line-height: 30px;
    }

    .goodsCategory ul li:hover {
        cursor: pointer;
    }

    .goodsCategory ul li:hover, .goodsCategory ul li.selected {
        background: #1C8FEF;
        color: #fff;
    }

    .goodsCategory ul li span {
        width: 120px;
        display: inline-block;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        vertical-align: middle;
        font-size: 12px;
    }

    .two {
        left: 160px;
        border-left: 0;
    }

    .three {
        left: 320px;
        width: 159px;
        border-left: 0;
    }

    .selectGoodsCategory {
        width: 218px;
        height: 45px;
        border: 1px solid #CCCCCC;
        position: absolute;
        z-index: 100;
        left: 0;
        margin-top: 299px;
        border-collapse: collapse;
        background: #fff;
        display: none;
    }

    .selectGoodsCategory a {
        display: block;
        height: 30px;
        width: 100px;
        text-align: center;
        color: #fff;
        line-height: 30px;
        margin: 8px;
        background: #0072D2;
        text-decoration: none;
    }

    input[type=number] {
        -moz-appearance: textfield;
    }

    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    input, textarea, .uneditable-input {
        width: 147px;
    }

    .table th {
        font-weight: normal;
    }

    .table th, .table td {
        vertical-align: middle;
    }

    .recommendBox {
        width: 360px;
        display: inline-block;
        float: right;
    }

    .introduction_box {
        width: 360px;
        display: inline-block;
        float: right;
    }

    .tab-content {
        overflow: visible;
    }

    .editGoodsIntroduction {
        display: inline-block;
        border: 1px dashed #fff;
        padding: 0 5px;
        width: 350px;
        line-height: 25px;
        max-height: 60px;
        overflow: hidden;
        text-overflow: ellipsis;
        height: 25px;
    }

    .editGoodsIntroduction:hover {
        border-color: #ddd;
        cursor: pointer;
    }

    .editGoodsIntroduction + input {
        display: inline-block;
        border: 1px solid #00C0FF;
        padding: 0 5px;
        width: 350px;
        line-height: 25px;
        height: 25px;
        background: #EEF7FF;
        display: none;
        border-radius: 0;
    }

    .padding_none {
        height: auto;
    }

    .goods-fields-sort {
        cursor: pointer;
    }

    .goods-fields-sort span {
        background: url('ADMIN_IMG/goods_sort.png') no-repeat;
        width: 20px;
        height: 20px;
        display: inline-block;
        margin-left: 5px;
        vertical-align: middle;
        position: absolute;
    }

    .goods-fields-sort span.asc {
        background-position: 0 5px;
    }

    .goods-fields-sort span.selected.asc {
        background-position: -30px 5px;
    }

    .goods-fields-sort span.desc {
        background-position: 0 -24px;
    }

    .goods-fields-sort span.selected.desc {
        background-position: -30px -24px;
    }

    .pro_share {
        margin-left: 200px;
        font-size: 12px;
        cursor: pointer;
        color: deepskyblue;
    }

    .share_ye {
        position: absolute;
        top: 0;
        width: 300px;
        height: 300px;
        background-color: cyan;
    }

    .test {
        position: absolute;
        top: 0;
        width: 300px;
        height: 300px;
        background-color: #ccc;

    }

    .test .hr {
        width: 100%;
        height: 48px;
        border-bottom: 2px solid #000;

    }

    .test ul li {
        width: 33.3%;
        text-align: center;
        line-height: 48px;
        float: left;
    }

    #foot {
        width: 100%;
        height: 252px;
        /*background-color: cyan;*/
    }

    #foot div {
        width: 300px;
        height: 252px;

        display: none;
    }

    #foot .show {
        /*height: 252px;*/
        display: block;
    }

    .puple {
        background-color: red;
    }

    #frsit {
        width: 140px;
        height: 140px;

        background-color: cyan;
        margin: 0 auto;
        margin-top: 60px;
    }

    .zent {
        margin-top: 60px;
        text-align: center;

    }

    .mytable {
        border: 0;
    }

    .style0list tbody td {
        vertical-align: middle;
    }

    .style0list  tbody tr {
        border-bottom: 1px dashed #E3E3E3;
    }

    a {
        cursor: pointer;
    }

    select {
        height: 32px;
    }

    .head-portrait {
        width: 60px;
        height: 60px;
        float: left;
        margin-right: 10px;
    }

    .modal-body {
        max-height: none;
    }

    .modal-infp-style {
        width: 90%;
        margin: 10px auto;
    }

    .modal-infp-style table {
        width: 100%;
    }

    .modal-infp-style table tr td {
        border: 1px solid #e6e6e6;
        padding: 8px;
    }

    #balance {
        margin-bottom: 0;
    }

    #point {
        margin-bottom: 0;
    }

    #remark_point {
        margin-bottom: 0;
    }

    #remark_balance {
        margin-bottom: 0;
    }

    input[type="text"], input[type="password"], input.text, input.password {
        margin-bottom: 0;
    }

    input[type="radio"], input[type="checkbox"] {
        margin: 0px 5px 0;
    }

    label {
        width: 20%;
        float: left;
        font-weight: normal;
    }

    .required {
        color: red;
        margin-right: 10px;
    }

    .modal-tab tr td:first-child {
        text-align: right;
    }
    #motai-div{min-width: 60%}
    #myModal{min-width: 60%}
    .modal{left: 42%}
</style>
{/block}
{block name="main"}
<div class="js-mask-category"
     style="display:none;background: rgba(0,0,0,0);position:fixed;width:100%;height:100%;top:0;left:0;right:0;bottom:0;z-index:90;"></div>
<table class="mytable">
    <tr>
        <th style="text-align: left;">
            <button class="btn-common btn-small" onclick="location.href='{:__URL('ADMIN_MAIN/goods/addgoods')}';"
                    style="margin:0 !important;">发布商品
            </button>
        </th>
        <th style="position: relative;">
            商品分类：
            <div style="display: inline-block;position: relative;">
                <!--<div class="pro_share">推广商品</div>-->
                <input type="text" placeholder="请选择商品分类" id="goodsCategoryOne" is_show="false" class="input-common">
                <div class="goodsCategory one">
                    <ul>
                        {volist name="oneGoodsCategory" id="vo"}
                        <li class="js-category-one" category_id="{$vo.category_id}">
                            <span>{$vo.category_name}</span>
                            {if condition="$vo.is_parent eq 1"}
                            <i class="fa fa-angle-right fa-lg"></i>
                            {/if}
                        </li>
                        {/volist}
                    </ul>
                </div>
                <div class="goodsCategory two" style="border-left:0;">
                    <ul id="goodsCategoryTwo"></ul>
                </div>
                <div class="goodsCategory three">
                    <ul id="goodsCategoryThree"></ul>
                </div>
                <div class="selectGoodsCategory">
                    <a href="javascript:;" id="confirmSelect" style="float:right;">确认选择</a>
                </div>
                <input type="hidden" id="category_id_1">
                <input type="hidden" id="category_id_2">
                <input type="hidden" id="category_id_3">
            </div>
            商品名称：<input id="goods_name" class="input-medium input-common" type="text" value="{$search_info}"
                        placeholder="要搜索的商品名称">
            物料编码：<input id="material_code" class="input-medium input-common" type="text" placeholder="要搜索的物料编码"/>
            <input type="button" value="更多搜索" class="btn-common more_search"/>
            <input type="button" onclick="searchData()" value="搜索" class="btn-common"/>
            <input class="btn-common" type="button" onclick="dataExcel()" value="导出数据"/>

            <!--<input class="btn-common" type="button" onclick="cartDataImport()" value="导入想买清单"/>-->
            <!--<input class="btn-common" type="button" onclick="materialCode()" value="物料编码"/>-->
            <!--<input class="btn-common" type="button" onclick="codeUpdate()" value="同步编码"/>-->

            <div style="margin-top: 10px;display: none;" id="more_search">
                商品条形码：<input id="product_barcode" class="input-medium input-common" type="text" placeholder="要搜索的商品条形码"/>
                商品编码：<input id="goods_code" class="input-medium input-common" type="text" placeholder="要搜索的商品编码"/>
                商品标签：
                <input type="text" placeholder="请选择商品标签" id="selectGoodsLabel" onfocus="selectGoodsLabel();"
                       is_show="false" data-html="true" class="input-common"
                       title="<h6 class='edit-group-title'>选择商品标签</h6>" data-container="body" data-placement="bottom"
                       data-trigger="manual" data-content="<div class='edit-group' style='max-width:auto;'>
				{foreach $goods_group as $vo} 
				<p>
				<label class='checkbox-inline' style='display:inline-block;'>
				<input type='checkbox' value='{$vo.group_id}' onchange='clickGoodsLabel(this);'><span>{$vo.group_name}</span>&nbsp;&nbsp;&nbsp;
				</label>
			{/foreach}
			</div> 
			<button class='btn btn-primary btn-small' onclick='confirm();'>确认</button>
			<button class='btn btn-small' onclick='hideGroup()'>取消</button>
			">
                供货商：
                <select id="supplier_id" class="select-common w100">
                    <option value="">全部</option>
                    {notempty name="$supplier_list"}
                    {volist name="$supplier_list" id="vo"}
                    <option value="{$vo.supplier_id}">{$vo.supplier_name}</option>
                    {/volist}
                    {/notempty}
                </select><br/><br/>
                商品品牌：
                <select id="brand_id" class="select-common w150">
                    <option value="">全部</option>
                    {notempty name="$goods_brand_list"}
                    {volist name="$goods_brand_list" id="vo"}
                    <option value="{$vo.brand_id}">{$vo.brand_name}</option>
                    {/volist}
                    {/notempty}
                </select>
                销售方式：
                <select id="sale_type" class="select-common w100">
                    <option value="">全部</option>
                    <option value="1">现售</option>
                    <option value="2">预售</option>
                </select>
                上下架：
                <select id="state" class="select-common w100">
                    <option value="" {if condition="$state eq ''" }selected{/if}>全部</option>
                    <option value="1" {if condition="$state eq '1' " }selected{/if}>上架</option>
                    <option value="0" {if condition="$state eq '0' " }selected{/if}>下架</option>
                </select>
                来源类型：
                <select id="source_type" class="select-common w100">
                    <option value="" {if condition="$source_type eq ''" }selected{/if}>全部</option>
                    <option value="1" {if condition="$source_type eq '1' " }selected{/if}>大贸</option>
                    <option value="2" {if condition="$source_type eq '2' " }selected{/if}>跨境</option>
                </select>
                黑科技：
                <select id="is_black_tech" class="select-common w100">
                    <option value="" {if condition="$is_black_tech eq ''" }selected{/if}>全部</option>
                    <option value="0" {if condition="$is_black_tech eq '0' " }selected{/if}>常规商品</option>
                    <option value="1" {if condition="$is_black_tech eq '1' " }selected{/if}>排行耪</option>
                    <option value="2" {if condition="$is_black_tech eq '2' " }selected{/if}>体验专区</option>
                    <option value="3" {if condition="$is_black_tech eq '3' " }selected{/if}>小样</option>
                </select>
            </div>
        </th>
    </tr>
</table>
<div id="myTabContent" class="tab-content">
    <div class="tab-pane active">
        <table class="table table-striped table-main" border="0">
            <colgroup>
                <col width="1%">
                <col width="15%">
                <col width="10%">
                <col width="12%">
                <col width="9%">
                <col width="8%">
                <col width="10%">
                <col width="13%">
                <col width="8%">
                <col width="14%">
            </colgroup>
            <tbody>
            <tr class="table-title">
                <th></th>
                <th>商品名称</th>
                <!--<th>商品标签</th>-->
                <!--<th>促销语</th>-->
                <th class="goods-fields-sort" data-field="price" style="text-align: left;">价格(元)<span class="desc"></span></th>
                <!--<th style="text-align: center;">是否内购</th>-->
                <th style="text-align: center;">分润比例<span class="desc"></span></th>
                <th class="goods-fields-sort" data-field="stock" style="text-align: right;">总库存<span class="desc"></span></th>
                <th class="goods-fields-sort" data-field="sales" style="text-align: right;">销量<span class="desc"></span></th>
                <th style="text-align: center;">上下架</th>
                <th style="text-align: center;">实物类型</th>
                <th class="goods-fields-sort" data-field="sort" style="text-align: center;">排序<span class="desc"></span>
                </th>
                <th style="text-align:center;">操作</th>
            </tr>
            <tr class="trcss">
                <td colspan="5">
                    <input onclick="CheckAll(this)" type="checkbox" id="chek_all">
                    <span style="display: inline-block; margin-left: 0px; margin-right: 10px;font-weight: 400;">全选</span>
                    <a class="btn btn-small" href="javascript:batchDelete()">批量删除</a>

                    <a class="btn btn-small" id="setFraction" href="javascript:void(0)"
                       onclick="showFraction()" data-html="true" title="批量设置分润"
                       data-container="body" data-placement="bottom" data-trigger="manual"
                       data-content=
                               "<div class='edit-group' id='fractionValue'>
                                    <input id='fraction' class='input-medium input-common' type='number' min='0' max='30' value='0' placeholder='请输入0-30的正整数'>
                                    <br/>
                                    <span class='hint'>分润比率单位为百分比，如输入10，表示可以以商品销售价的10%分润</span>
					            </div>
					            <button class='btn btn-primary btn-small' onclick='setFraction();'>保存</button>
					            <button class='btn btn-small' onclick='hideSetFraction()'>取消</button>"
                    >批量设置分润</a>

                    <a class="btn btn-small" id="batchCopyGoods" href="javascript:void(0)" onclick="batchCopyGoods()"
                       data-html="true" title="批量复制商品" data-container="body" data-placement="bottom" data-trigger="manual">批量复制商品</a>

                    <a class="btn btn-small upstore" href="javascript:void(0)" onclick="goodsIdCount('online')">上架</a>
                    <a class="btn btn-small downstore" href="javascript:void(0)"
                       onclick="goodsIdCount('offline')">下架</a>
                    <a class="btn btn-small recommend" href="javascript:void(0)" onclick="ShowRecommend()"
                       data-html="true" id="setRecommend" title="推荐"
                       data-container="body" data-placement="bottom" data-trigger="manual"
                       data-content="<div class='edit-group' id='recommendType'>
							<label class='checkbox-inline'><input type='checkbox' value='1'>排行榜 </label>
							<label class='checkbox-inline'><input type='checkbox' value='2'>常规商品 </label>
							</div>
							<button class='btn btn-primary btn-small' onclick='setRecommend();'>保存</button>
							<button class='btn btn-small' onclick='hideSetRecommend()'>取消</button>
							"
                    >推荐</a>
                    <a onclick="goodsGroupIdCount();" data-html="true" class="btn btn-small fun-a category"
                       href="javascript:void(0)" id="editGroup" title="修改商品标签" data-container="body"
                       data-placement="bottom" data-trigger="manual"
                       data-content="<div class='edit-group' id='goodsChecked' style='max-width:auto;'>
 							{foreach $goods_group as $vo} 
 							<p>
 							<label class='checkbox-inline' style='display:inline-block;' >
								<input type='checkbox' value='{$vo.group_id}'><span>{$vo.group_name}</span>&nbsp;&nbsp;&nbsp;
							</label>
							{foreach $vo['sub_list']['data'] as $vs}
							<label style='display:inline-block;'>
								<input type='checkbox' value='{$vs.group_id}'>{$vs.group_name}
								</label>
								{/foreach}
							</p>
							{/foreach}
							</div>
							<button class='btn btn-primary btn-small' onclick='goodsGroupUpdate();'>保存</button>
							<button class='btn btn-small' onclick='hideEditGroup()'>取消</button>
							">
                        商品标签</a>
                    <a href="javascript:;" class="btn btn-small fun-a category" title="更新二维码"
                       onclick="batchUpdateGoodsQrcode();">更新二维码</a>
                    <input type='hidden' id='goods_type_ids'/>
                </td>
            </tr>
            </tbody>
            <tbody id="productTbody" style="border: 0px;"></tbody>
        </table>
    </div>
    <input type="hidden" id="selectGoodsLabelId">
    <input type="hidden" id="stock_warning" value="{$stock_warning}">
</div>
<input type="hidden" id="hidden_sort_rule"/>



<!-- -----------------   模态框  -------------------- -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="exampleModalLabel">选择分类</h4>
            </div>
            <div class="modal-body">
                <select name="" id="">
                    {volist name="oneGoodsCategory" id="vo"}
                    <option value="{$vo.category_id}">{$vo.category_name}</option>
                    {/volist}
                </select>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" id="category_click" class="btn btn-primary">确认</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade hide" id="batchCopyGoodsSubmit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" >
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">复制商品</h4>
            </div>
            <div class="modal-body" style="min-height: 150px;">
                <div class="modal-infp-style">
                    <table class="modal-tab">
                        <tr>
                            <td>所属分类</td>
                            <td>
                                <p>
                                    <select id="category_id1" style="margin-top: 15px">
                                    <option value="">请选择:</option>
                                    {if $oneGoodsCategory}
                                    {foreach name="$oneGoodsCategory" item="vo"}
                                    <option value="{$vo.category_id}">{$vo.category_name}</option>
                                    {/foreach}

                                    {/if}
                                    </select>
                                </p>
                            </td>
                        </tr>
                        <tr>
                            <td style="width:20%" rowspan="2">专属名称</td>
                            <td id="name_add_type">
                                <label style="width:70px"><input type="radio" name="name_add_type" checked value="1" />前缀&nbsp;&nbsp;</label>
                                <label style="width:70px"><input type="radio" name="name_add_type" value="2" />后缀&nbsp;&nbsp;</label>
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align: left">
                                <input type="text" id="name" class="input-common w200"/>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="modal-footer">
                <input type="hidden" id="goods_ids" />
                <button class="btn btn-info" onclick="batchCopyGoodsSubmit()">保存</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" id="motai-div" aria-labelledby="myLargeModalLabel"></div>
{/block}
{block name="script"}
<script type="text/javascript">
    $(function () {
        $.ajax({
            type: "post",
            url: "{:__URL('ADMIN_MAIN/goods/checkStockAuth')}",
            success: function (data) {
                if (data === 2) {
                    $(".auth-stock").attr("readonly",true);
                }
            }
        });

        $(".js-update-goods-name,.js-update-introduction").live("blur", function () {
            var up_type = $(this).attr("data-up-type");
            var goods_id = $(this).attr("data-goods-id");
            var editContent = $(this).val();
            if (editContent == "") {
                if (up_type == "goods_name") {
                    showTip("商品名不可为空", "warning");
                    $(this).focus();
                    return false;
                }
            }
            var $self = $(this);
            $.ajax({
                type: "post",
                url: "{:__URL('ADMIN_MAIN/goods/ajaxEditGoodsNameOrIntroduction')}",
                data: {
                    "goods_id": goods_id,
                    "up_type": up_type,
                    "up_content": editContent
                },
                success: function (data) {
                    if (data['code'] > 0) {
                        $self.prev(".editGoodsIntroduction").children("a").text(editContent);
                    }
                    $self.hide();
                    $self.prev(".editGoodsIntroduction").show();
                }
            });
        }).live("keyup", function (event) {
            if (event.keyCode == 13) $(this).blur();
        });

        //排序规则
        $(".goods-fields-sort").click(function () {
            var field = $(this).attr("data-field");
            var sort_rule = $(this).attr("data-field");
            $(this).siblings().css("color", "#333333").find("span").removeClass("desc selected").addClass("desc");
            $(this).css("color", "#0072D2");
            if ($(this).find("span").hasClass("desc") && $(this).find("span").hasClass("selected")) {
                $(this).find("span").removeClass("desc").addClass("selected asc");
                sort_rule += ",a";
            } else if (($(this).find("span").hasClass("asc") && $(this).find("span").hasClass("selected")) || $(this).find("span").hasClass("desc")) {
                $(this).find("span").removeClass("asc").addClass("selected desc");
                sort_rule += ",d";
            }
            $("#hidden_sort_rule").val(sort_rule);
            LoadingInfo(1);
        });

    });

    function searchData() {
        LoadingInfo(1);
    }

    //隐藏商品分组
    function hideEditGroup() {
        $("#editGroup").popover("hide");
    }

    function hideSetRecommend() {
        $("#setRecommend").popover("hide");
    }

    /**
     * 商品数据导出
     */
    function dataExcel(){
        var category_id_1 = $("#category_id_1").val();//一级商品分类
        var category_id_2 = $("#category_id_2").val();//二级商品分类
        var category_id_3 = $("#category_id_3").val();//三级商品分类
        var goods_name = $("#goods_name").val();//商品名称
        var goods_code = $("#goods_code").val();//商品编码
        var product_barcode = $("#product_barcode").val();//商品条形码
        var material_code = $("#material_code").val();//shopal物料编码
        var selectGoodsLabelId = $("#selectGoodsLabelId").val();//商品标签
        var supplier_id = $("#supplier_id").val();//供货商
        var brand_id = $("#brand_id").val();//商品品牌
        var sale_type = $("#sale_type").val();//销售方式
        var state = $("#state").val();//上下架
        var source_type = $("#source_type").val();//来源类型
        var is_black_tech = $("#is_black_tech").val();//黑科技
        var stock_warning = $("#stock_warning").val();//库存预警
        var sort_rule = $("#hidden_sort_rule").val();// 字段排序规则
        var goods_ids = new Array();
        $("#productTbody input[type='checkbox']:checked").each(function () {
            if (!isNaN($(this).val())) {
                goods_ids.push($(this).val());
            }
        });
        window.location.href=__URL("ADMIN_MAIN/goods/goodsDataExcel?category_id_1="+category_id_1+"&category_id_2="+category_id_2+"&category_id_3="+category_id_3+"&goods_name="+goods_name+"&goods_code="+goods_code+"&product_barcode="+product_barcode+"&material_code="+material_code+"&selectGoodsLabelId="+selectGoodsLabelId+"&supplier_id="+supplier_id+"&brand_id="+brand_id+"&sale_type="+sale_type+"&state="+state+"&source_type="+source_type+"&is_black_tech="+is_black_tech+"&stock_warning="+stock_warning+"&sort_rule="+sort_rule+"&goods_ids="+goods_ids.toString());
    }

    function cartDataImport() {
        $.ajax({
            type : "post",
            url : "{:__URL('ADMIN_MAIN/goods/cartDataImport')}",
            data : {},
            success : function(data) {
                var data = JSON.parse(data);
                if (data.errcode == 0) {
                    showMessage('success', data["errmsg"]);
                } else {
                    showMessage('error', data["errmsg"]);
                }
            }
        });
    }

    //同步ns_goods表的material_code到ns_goods_sku表
    function materialCode() {
        $.ajax({
            type : "post",
            url : "{:__URL('ADMIN_MAIN/goods/materialCode')}",
            data : {},
            success : function(data) {
                var data = JSON.parse(data);
                if (data.errcode == 0) {
                    showMessage('success', data["errmsg"]);
                } else {
                    showMessage('error', data["errmsg"]);
                }
            }
        });
    }

    //同步ns_goods_sku表的code,material_code到ns_order_goods表
    function codeUpdate() {
        $.ajax({
            type : "post",
            url : "{:__URL('ADMIN_MAIN/goods/codeUpdate')}",
            data : {},
            success : function(data) {
                var data = JSON.parse(data);
                if (data.errcode == 0) {
                    showMessage('success', data["errmsg"]);
                } else {
                    showMessage('error', data["errmsg"]);
                }
            }
        });
    }

    function skuDetail(goods_id) {
        $.ajax({
            type: "post",
            data: {
                "goods_id": goods_id
            },
            url: "{:__URL('ADMIN_MAIN/goods/getGoodsSkuList')}",
            success: function (data) {
                var sku_array = data;
                var html = '';
                html += '<div class="modal-dialog modal-lg" role="document">';
                html += '<div class="modal-content">';
                html += '<div class="modal-header">';
                html += '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>';
                html += '<h4 class="modal-title" id="myModalLabel">修改库存</h4>';
                html += '</div>';
                html += '<div class="modal-body">';
                html += '<table class="table table-bordered table-class">';
                html += '<thead>';
                html += '<tr>';
                html += '<th>规格名称</th>';
                html += '<th>物料编码</th>';
                html += '<th>库存</th>';
                html += '<th>价格</th>';
                html += '</tr>';
                html += '</thead>';
                html += '<tbody>';
                if (sku_array.length > 0) {
                    for (var i = 0; i < sku_array.length; i++) {
                        html += '<tr>';
                        html += '<td>'+ sku_array[i]['sku_name'] +'</td>';
                        html += '<td>'+ sku_array[i]['material_code'] +'</td>';
                        html += '<td><input name="sku_stock" sku_id="'+ sku_array[i]['sku_id'] +'" type="number" value="'+ sku_array[i]['stock'] +'"></td>';
                        html += '<td>'+ sku_array[i]['price'] +'</td>';
                        html += '</tr>';
                    }
                    html += '</tbody>';
                    html += '</table>';
                    html += '</div>';
                    html += '<div class="modal-footer">';
                    html += '<button type="button" class="btn btn-primary" data-dismiss="modal" onclick="changeSkuStock('+goods_id+')">确定</button>';
                    html += '<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>';
                    html += '</div>';
                    html += '</div>';
                    html += '</div>';
                }else{
                    html += '<tr align="center"><td colspan="6" style="text-align: center">暂无可选规格</td></tr>';
                }
                $("#motai-div").html(html);
            }
        });
    }

    function changeSkuStock(goods_id) {
        $sku_array = new Array();
        $("[name='sku_stock']").each(function() {
            var sku_id = $(this).attr('sku_id');
            var sku_num = $(this).val();
            $sku_array.push({
                'sku_id':sku_id,
                'stock':sku_num
            });
        });
        if($sku_array.length>0){
            $.ajax({
                type: "post",
                data: {
                    "goods_id" : goods_id,
                    "sku_array": $sku_array
                },
                url: "{:__URL('ADMIN_MAIN/goods/updateSkuNum')}",
                success: function (data) {
                    showMessage('success', '修改成功', "{:__URL('ADMIN_MAIN/goods/goodsList')}");
                }
            });
        }
    }

    function LoadingInfo(page_index) {
        var start_date = $("#startDate").val();

        var end_date = $("#endDate").val();
        var sale_type = $("#sale_type").val();
        var state = $("#state").val();
        var source_type = $("#source_type").val();
        var is_black_tech = $("#is_black_tech").val();
        var goods_name = $("#goods_name").val();
        var goods_code = $("#goods_code").val();
        var product_barcode = $("#product_barcode").val();
        var material_code = $("#material_code").val();
        var category_id_1 = $("#category_id_1").val();
        var category_id_2 = $("#category_id_2").val();
        var category_id_3 = $("#category_id_3").val();
        var selectGoodsLabelId = $("#selectGoodsLabelId").val();
        var supplier_id = $("#supplier_id").val();
        var brand_id = $("#brand_id").val();
        var stock_warning = $("#stock_warning").val();
        $.ajax({
            type: "post",
            url: "{:__URL('ADMIN_MAIN/goods/goodslist')}",
            data: {
                "page_index": page_index,
                "page_size": $("#showNumber").val(),
                "start_date": start_date,
                "end_date": end_date,
                "sale_type":sale_type,
                "state": state,
                "source_type": source_type,
                "is_black_tech": is_black_tech,
                "goods_name": goods_name,
                "code": goods_code,
                "product_barcode": product_barcode,
                "material_code": material_code,
                "category_id_1": category_id_1,
                "category_id_2": category_id_2,
                "category_id_3": category_id_3,
                "selectGoodsLabelId": selectGoodsLabelId,
                "supplier_id": supplier_id,
                "brand_id":brand_id,
                "stock_warning": stock_warning,
                'sort_rule': $("#hidden_sort_rule").val()
            },
            success: function (data) {

                var html = '';

                if (data["data"].length > 0) {
                    for (var i = 0; i < data["data"].length; i++) {

                        html += '<tr class="tr-title">';
                        html += '<td class="td-' + data["data"][i]["goods_id"] + '">';
                        html += '<label style="text-align: center;vertical-align: middle;margin: 0 0 0 -1px;">';
                        html += '<input value="' + data["data"][i]["goods_id"] + '" name="sub" data-state="' + data["data"][i]["state"] + '" type="checkbox">';
                        html += '</label>';
                        html += '</td>';

                        html += '<td colspan="9">';
                        html += '<div style="display: inline-block; width: 100%;font-size:12px;" class="pro-code">';
                        html += '<span>ID：' + data["data"][i]["goods_id"] + '</span>';
                        if (data["data"][i]["source_type"] == 1) {
                            html += '<span style="margin-left:10px;">来源类型：大贸</span>';
                        } else {
                            html += '<span style="margin-left:10px;">商品类型：跨境</span>';
                        }

                        html += '<span style="margin-left:10px;">商品编码' + '：' + data["data"][i]["code"] + '</span>';
                        if (data["data"][i]["product_barcode"]) {
                            html += '<span style="margin-left:10px;">商品条形码' + '：' + data["data"][i]["product_barcode"] + '</span>';
                        }
                        html += '<span style="margin-left:10px;">物料编码' + '：' + data["data"][i]["material_code"] + '</span>';
                        html += '<span class="pro-code" style="margin-left:10px;">创建时间：' + timeStampTurnTime(data["data"][i]["create_time"]);
                        html += '<span class="div-flag-style" style="display: inline-block;margin:0 20px 0 40px;position:relative">';
                        html += '<i class="icon-qrcode"style="background: none; color: #555; font-size: 20px; margin-right: 0;"></i>';
                        html += '<div class="QRcode" style="display: none; position: absolute;width:110px;top:28px;left:0;"id="qrcode">';
                        html += '<p><img src="' + __IMG(data["data"][i]["QRcode"]) + '" style="width:110px;"></p>';

                        html += '</div>';

                        html += '</span>';
                        // html += '<div class="pro_share"  style="position: relative;">推广商品<div class="test" style="display:none">';
                        // html += '<ul class="hr">';
                        // html += ' <li>商品二维码</li>';
                        // html += '<li>商品链接</li>';
                        // html += '<li>小程序码</li>';
                        // html += '</ul>';

                        // html += ' <ul class="footer" id="foot">';
                        // html += ' <div class="show">';
                        // html += ' <p id="frsit"></p>';
                        // html += ' </div>';
                        // html += ' <div>';
                        // html += ' <p class="zent"><input type="text" class="zent-input" value="https://h5.youzan.com/v2/goods/270auytg0glrg" disabled=""><span class="zent-input-addon-after"><span>复制</span></span></p>';
                        // html += ' </div>';
                        // html += ' <div>第三个</div>';

                        // html += ' </ul>';
                        // html += '</div>';


                        html += '</span>';
                        html += '</div>';
                        html += '</td>';

                        html += '</tr>';

                        html += '<tr>';
                        html += '<td colspan="2">';
                        html += '<div style="width:450px;">';
                        html += '<a class="a-pro-view-img" href="' + __URL('APP_MAIN/goods/goodsdetail?id=' + data["data"][i]["goods_id"]) + '" target="_blank" style="height:70px;line-height:70px;text-align:center;">';
                        html += '<img class="thumbnail-img" src="' + __IMG(data["data"][i]["pic_cover_micro"]) + '">';
                        html += '</a>';
                        html += '<div class="div-pro-view-name">';
                        html += '<span style="color: #13A5D5;" class="thumbnail-name title=' + data["data"][i]["goods_name"] + '">';
                        html += '<div class="editGoodsIntroduction padding_none" ondblclick="editGoodsInfo(this)">';
                        if(data['data'][i]['fb_color'] == 1){
                            html += '<a target="_blank" style="word-break:break-all;" href="' + __URL('APP_MAIN/goods/goodsdetail?id=' + data["data"][i]["goods_id"]) + '">' + data["data"][i]["fb_name1"] + '</a>';
                            html += '&nbsp;';
                            html += '<a target="_blank" style="word-break:break-all; color: coral" href="' + __URL('APP_MAIN/goods/goodsdetail?id=' + data["data"][i]["goods_id"]) + '">' + data["data"][i]["fb_name2"] + '</a>';
                        }else{
                            html += '<a target="_blank" style="word-break:break-all;" href="' + __URL('APP_MAIN/goods/goodsdetail?id=' + data["data"][i]["goods_id"]) + '">' + data["data"][i]["goods_name"] + '</a>';
                        }
                        html += '</div>';
                        html += '<input class="js-update-goods-name" data-goods-id ="' + data['data'][i]['goods_id'] + '" data-up-type="goods_name" type="text" value="' + data["data"][i]['goods_name'] + '"/>';
                        html += '</span>';
                        html += '<br/>';

                        if (data["data"][i]['introduction'] != '' && data["data"][i]['introduction'] != undefined) {

                            html += '<div class="editGoodsIntroduction" ondblclick="editGoodsInfo(this)">';
                            html += '<span style="color:#999;font-size:12px;display:block;height:25px;overflow:hidden;text-decoration: none;">' + data["data"][i]['introduction'] + '</span>';
                            html += '</div>';
                            html += '<input data-goods-id ="' + data['data'][i]['goods_id'] + '" data-up-type="introduction" class="js-update-introduction" type="text" maxlength="60" value="' + data["data"][i]['introduction'] + '" />';

                        }
                        html += '<div style="position: relative;margin-left: 75px;">';
                        if (data["data"][i]['is_black_tech'] == 1) {
                            html += '<i class="black_tech">排行耪</i>';
                        } else if (data["data"][i]['is_black_tech'] == 2) {
                            html += '<i class="black_tech">体验专区</i>';
                        } else if (data["data"][i]['is_black_tech'] == 3) {
                            html += '<i class="black_tech">小样</i>';
                        } else {
                            html += '';
                        }
                        if (data["data"][i]['sale_type'] == 2) {
                            html += '<i class="sale_type">预售</i>';
                        }
                        html += data["data"][i]["is_hot"] == 1 ? '<i class="hot">热</i>' : '';
                        html += data["data"][i]["is_recommend"] == 1 ? '<i class="recommend">精</i>' : '';
                        html += data["data"][i]["is_new"] == 1 ? '<i class="new">新</i>' : '';
                        if (data["data"][i]['goods_group_name'] != '' && data["data"][i]['goods_group_name'] != undefined) {
                            var tmp_array = data["data"][i]['goods_group_name'].split(",");
                            $.each(tmp_array, function (k, v) {
                                if (v != "") {
                                    html += '<i style="color:#999;font-size:12px;margin-top:5px;padding:1px 2px;border-radius:3px;display:inline-block;color:#FFF;background-color:#de533c;text-decoration: none;height:16px;line-height: 16px;overflow:hidden;margin-right:5px;text-align:center;font-style:normal;">' + v + '</i>';
                                }
                            });
                        }
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                        html += '</td>';

                        html += '<td style="text-align: left;">';
                        if (data["data"][i]["price"] != data["data"][i]["promotion_price"]) {
                            html += '<div class="priceaddactive">';
                            html += '<span class="price-lable">原&nbsp;&nbsp;&nbsp;价：</span>';
                            html += '<span class="price-numble" style="color: #666;"id="moreChangePrice' + data["data"][i]["goods_id"] + '">' + data["data"][i]["price"] + '</span>';
                            html += '</div>';
                        }
                        html += '<div>';
                        html += '<span class="price-lable" >销售价：</span><span class="price-numble" id="moreChangePrice' + data["data"][i]["goods_id"] + '" style="color:red;">' + data["data"][i]["promotion_price"] + '</span>';
                        html += '</div>';
                        if (data["data"][i]["vip_price"] != 0) {
                            html += '<div class="priceaddactive">';
                            html += '<span class="price-lable" >会员价：</span><span class="price-numble" id="moreChangePrice' + data["data"][i]["goods_id"] + '" style="color:red;">' + data["data"][i]["vip_price"] + '</span>';
                            html += '</div>';
                        }
                        html += '</td>';

//                        if (data["data"][i]["is_inside_sell"] == 1) {
//                            html += '<td style="text-align: center;"><a href="javascript:modifyGoodsOffInside(' + data["data"][i]["goods_id"] + ')">撤销内购</a></td>';
//                        } else {
//                            html += `<td style="text-align: center;"><a style="color:#999;" href="javascript:modifyGoodsShowInside(` + data["data"][i]["goods_id"] + `,` + data["data"][i]["inside_price"] + `)"
//                                data-html="true" id="setInside` + data["data"][i]["goods_id"] + `" title="确认内购价" data-container="body" data-placement="bottom" data-trigger="manual"
//                                data-content="
//                                              <div><input id='inside_price' class='input-medium input-common'><br/><br/></div>
//							                  <button class='btn btn-primary btn-small' onclick='modifyGoodsOnInside();'>保存</button>
//							                  <button class='btn btn-small' onclick='hideModifyGoodsShowInside()'>取消</button>
//							                  <input type='hidden' id='goods_id'/>
//							                 "
//                                    >参与内购</a></td>`;
//                        }

                        html += '<td style="text-align: center;">';
                        html += '<div class="cell">';
                        html += '<span class="pro-stock" style="color: #666;" id="moreChangeStock' + data["data"][i]["goods_id"] + '">' + Math.round(data["data"][i]["fraction"]*100) + '%</span>';
                        html += '</div>';
                        html += '</td>';

                        html += '<td style="text-align: right;">';
                        html += '<div class="cell">';
//                        html += '<input class="input-common input-common-sort auth-stock" goods_id="' + data["data"][i]["goods_id"] + '" style="width:38px;text-align:center;margin:0;" value="' + data["data"][i]["stock"] + '" onchange="changeStock(this)"' + 'type="number" title="编辑库存">';
                        html += '<div class="pro-stock" onclick="clickStock(this);" style="color: #666;text-align: center" id="moreChangeStock' + data["data"][i]["goods_id"] + '">' + data["data"][i]["stock"] + '</div>';
                        html += '<div class="pro-stock" data-toggle="modal" data-target=".bs-example-modal-lg" onclick="skuDetail(' + data["data"][i]["goods_id"] + ');" style="color: #0072D2;text-align: center;cursor:pointer">编辑</div>';
                        html += '</div>';
                        html += '</td>';

                        html += '<td style="text-align: right;">';
                        html += '<div class="cell">';
                        html += '<span class="pro-stock" style="color: #666;" id="moreChangeStock' + data["data"][i]["goods_id"] + '">' + data["data"][i]["sales"] + '</span>';  // todo @陈 将显示的实际销量(real_sales)改为显示基础销量(sales)
                        html += '</div>';
                        html += '</td>';

                        if (data["data"][i]["state"] == 1) {
                            html += '<td style="text-align: center;"><a href="javascript:modifyGoodsOnline(' + data["data"][i]["goods_id"] + ',\'offline\')">已上架</a></td>';
                        } else {
                            html += '<td style="text-align: center;"><a href="javascript:modifyGoodsOnline(' + data["data"][i]["goods_id"] + ',\'online\')" style="color:#999;">已下架</a></td>';
                        }

                        html += '<td style="text-align: center;">';
                        if (data['data'][i]['goods_type'] == 1) {
                            html += '<span>实物商品</span>';
                        } else if (data['data'][i]['goods_type'] == 2) {
                            html += '<span>实物礼品</span>';
                        } else if (data['data'][i]['goods_type'] == 3) {
                            html += '<span>会员</span>';
                        } else {
                            html += '<span>虚拟商品</span>';
                        }
                        html += '</td>';

                        html += '<td style="text-align: center;">';
                        html += '<div class="cell">';
                        html += '<input class="input-common input-common-sort" goods_id="' + data["data"][i]["goods_id"] + '" style="width:38px;text-align:center;margin:0;" value="' + data["data"][i]["sort"] + '" onchange="changeSort(this)"' + 'type="number" title="排序号数值越大，商城商品列表显示越靠前">';
                        html += '</div>';
                        html += '</td>';

                        html += '<td>';
                        html += '<div class="bs-docs-example tooltip-demo"style="text-align: right;">';
                        html += '<a href="' + __URL("ADMIN_MAIN/goods/wxCodeList?goodsId=" + data["data"][i]["goods_id"]) + '" title="小程序码" style="padding-right:10px;">小程序码</a><br/>';
                        html += '<a href="' + __URL("ADMIN_MAIN/goods/addgoods?step=2&goodsId=" + data["data"][i]["goods_id"]) + '" title="编辑商品" style="padding-right:10px;">编辑商品</a><br/>';
//                        html += '<a class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" data-whatever="@mdo">复制商品</a>';
                        html += '<a href="javascript:copyGoodsDetail(' + data["data"][i]["goods_id"] + ')" title="复制商品" style="padding-right:10px;">复制商品</a><br/>';
                        html += '<a href="javascript:deleteGoods(' + data["data"][i]["goods_id"] + ')" title="删除商品" style="padding-right:10px;">删除商品</a>';
                        html += '</div>';
                        html += '</td>';
                        html += '</tr>';
                    }
                } else {
                    html += '<tr align="center"><td colspan="9" style="text-align: center;font-weight: normal;color: #999;">暂无符合条件的数据记录</td></tr>';
                }
                $("#productTbody").html(html);
                initPageData(data["page_count"], data['data'].length, data['total_count']);
                $("#pageNumber").html(pagenumShow(jumpNumber, $("#page_count").val(), {$pageshow}));
                code();
//			小程序码
                $(function () {
                    var lis = $(".test li")

                    var divs = $(".footer>div")
                    for (var i = 0; i < lis.length; i++) {
                        lis[i].index = i;//此处为难点，意思是给每一个按钮设置一个index属性

                        lis[i].onclick = function () {
                            //清空所有的按钮和div的类
                            for (var j = 0; j < lis.length; j++) {
                                lis[j].className = '';
                                divs[j].className = '';
                            }
                            //把当前的按钮和对应的div的class设置成对应格式
                            this.className = "puple";
                            divs[this.index].className = "show";//this.index=btns[i].index 记录了当前点击按钮的索引值
                        }
                    }

                })

                $(".pro_share").click(function () {
                    $(".test").css("display", "block")

                    return false;

                })


                $('body').click(function () {
                    $(".test").css("display", "none")

                })
                $('.test').click(function () {
                    return false
                });


            }
        });
    }

    //二维码
    function code() {
        $(".div-flag-style").mouseover(function () {
            $(this).children('.QRcode').show();
        });
        $(".div-flag-style").mouseout(function () {
            $(this).children('.QRcode').hide();
        });
    }

    //把值传过去即可
    function updateGoodsDetail(goods_id) {
        window.location = __URL("ADMIN_MAIN/goods/addgoods?step=2&goodsId=" + goods_id);
    }

    //全选
    function CheckAll(event) {
        var checked = event.checked;
        $("#productTbody input[type = 'checkbox']").prop("checked", checked);
    }

    //商品上架id合计
    function goodsIdCount(line) {
        var goods_ids = "";
        $("#productTbody input[type='checkbox']:checked").each(function () {
            if (!isNaN($(this).val())) {
                var state = $(this).data("state");
//			if(line == "online"){
//				if(state == 1){
//					$( "#dialog" ).dialog({
//						buttons: {
//							"确定": function() {
//								$(this).dialog('close');
//							}
//						},
//						contentText:"记录中包含已上架记录",
//						title:"消息提醒",
//					});
//					return false;
//				}
//			}else{
//				if(state == 0){
//					$( "#dialog" ).dialog({
//						buttons: {
//							"确定": function() {
//								$(this).dialog('close');
//							}
//						},
//						contentText:"记录中包含已下架记录",
//						title:"消息提醒",
//					});
//				return false;
//				}
//			}
                goods_ids = $(this).val() + "," + goods_ids;
            }
        });
        goods_ids = goods_ids.substring(0, goods_ids.length - 1);
        if (goods_ids == "") {
            $("#dialog").dialog({
                buttons: {
                    "确定": function () {
                        $(this).dialog('close');
                    }
                },
                contentText: "请选择需要操作的记录",
                title: "消息提醒",
            });
            return false;
        }
        modifyGoodsOnline(goods_ids, line);
    }

    //商品上下架
    function modifyGoodsOnline(goods_ids, line) {
        if (line == "online") {
            var url = "{:__URL('ADMIN_MAIN/Goods/modifygoodsonline')}";
            var lingStr = "上架";
        } else {
            var url = "{:__URL('ADMIN_MAIN/Goods/modifygoodsoffline')}";
            var lingStr = "下架";
        }
        $.ajax({
            type: "post",
            url: url,
            data: {"goods_ids": goods_ids},
            success: function (data) {
                if (data["code"] > 0) {
                    LoadingInfo(getCurrentIndex(goods_ids, '#productTbody', 'tr[class="tr-title"]'));
                    $("#dialog").dialog({
                        buttons: {
                            "确定": function () {
                                $(this).dialog('close');
                            }
                        },
                        contentText: "商品" + lingStr + "成功",
                        title: "消息提醒",
                        time: 3
                    });
                }
            }
        })
    }

    function batchDelete() {
        var goods_ids = new Array();
        $("#productTbody input[type='checkbox']:checked").each(function () {
            if (!isNaN($(this).val())) {
                goods_ids.push($(this).val());
            }
        });
        if (goods_ids.length == 0) {
            $("#dialog").dialog({
                buttons: {
                    "确定,#e57373": function () {
                        $(this).dialog('close');
                    }
                },
                contentText: "请选择需要操作的记录",
                title: "消息提醒",
            });
            return false;
        }
        deleteGoods(goods_ids);
    }

    function deleteGoods(goods_ids) {
        $("#dialog").dialog({
            buttons: {
                "确定": function () {
                    $.ajax({
                        type: "post",
                        url: "{:__URL('ADMIN_MAIN/goods/deletegoods')}",
                        data: {"goods_ids": goods_ids.toString()},
                        dataType: "json",
                        success: function (data) {
                            if (data["code"] > 0) {
                                LoadingInfo(getCurrentIndex(goods_ids, '#productTbody', 'tr[class="tr-title"]'));
                                $("#dialog").dialog({
                                    buttons: {
                                        "确定": function () {
                                            $(this).dialog('close');
                                        }
                                    },
                                    modal: true,
                                    contentText: data["message"],
                                    title: "消息提醒",
                                    time: 1
                                });
                                $("#chek_all").prop("checked", false);
                            }
                        }
                    });
                    $(this).dialog('close');
                },
                "取消,#e57373": function () {
                    $(this).dialog('close');
                },
            },
            contentText: "确定要删除吗？",
        });
    }

    //商品修改分组id合计
    function goodsGroupIdCount() {
        var goods_ids = "";
        $("#productTbody input[type='checkbox']:checked").each(function () {
            if (!isNaN($(this).val())) {
                goods_ids = $(this).val() + "," + goods_ids;
            }
        });
        goods_ids = goods_ids.substring(0, goods_ids.length - 1);
        if (goods_ids == "") {
            $("#dialog").dialog({
                buttons: {
                    "确定": function () {
                        $(this).dialog('close');
                    }
                },
                contentText: "请选择需要操作的记录",
                title: "消息提醒",
            });
            return false;
        }
        $("#goods_type_ids").val(goods_ids);
        $("#editGroup").popover("show");
        $(".popover").css("max-width", '1000px');
    }

    //商品修改分组
    function goodsGroupUpdate() {
        var goods_type = "";
        var goods_ids = $("#goods_type_ids").val();
        $("#goodsChecked input[type='checkbox']:checked").each(function () {
            if (!isNaN($(this).val())) {
                goods_type = $(this).val() + "," + goods_type;
            }
        })
        // if(goods_type == ""){
        // 	$( "#dialog" ).dialog({
        // 		buttons: {
        // 			"确定": function() {
        // 				$(this).dialog('close');
        // 			}
        // 		},
        // 		contentText:"请选择需要操作的记录",
        // 		title:"消息提醒",
        // 	});
        // 	return false;
        // }
        goods_type = goods_type.substring(0, goods_type.length - 1);
        $.ajax({
            type: "post",
            url: "{:__URL('ADMIN_MAIN/goods/modifygoodsgroup')}",
            data: {"goods_id": goods_ids, "goods_type": goods_type},
            success: function (data) {
                if (data["code"] > 0) {
                    $("#editGroup").popover("hide");
                    LoadingInfo(getCurrentIndex(goods_ids, '#productTbody', 'tr[class="tr-title"]'));
                    $("#dialog").dialog({
                        buttons: {
                            "确定": function () {
                                $(this).dialog('close');
                            }
                        },
                        contentText: data["message"],
                        title: "消息提醒",
                    });
                }
            }
        })
    }

    //显示内购价设置
//    function modifyGoodsShowInside(goods_id, inside_price) {
//        $("#setInside" + goods_id).popover("show");
//        $("#goods_id").val(goods_id);
//        $("#inside_price").val(inside_price);
//
//    }

    //隐藏内购价设置
//    function hideModifyGoodsShowInside() {
//        var goods_id = $("#goods_id").val();
//        $("#setInside" + goods_id).popover("hide");
//    }

    //保存内购价设置
//    function modifyGoodsOnInside() {
//        var goods_id = $("#goods_id").val();
//        var inside_price = $("#inside_price").val();
//        if (inside_price < 0.01) {
//            $("#dialog").dialog({
//                buttons: {
//                    "确定": function () {
//                        $(this).dialog('close');
//                    }
//                },
//                contentText: "内购价不能低于0.01元",
//                title: "消息提醒",
//            });
//            return false;
//        }
//        $.ajax({
//            type: "post",
//            url: "{:__URL('ADMIN_MAIN/goods/modifyGoodsOnInside')}",
//            data: {
//                "goods_id": goods_id,
//                "inside_price": inside_price
//            },
//            success: function (data) {
//                if (data["code"] > 0) {
//                    $("#setInside" + goods_id).popover("hide");
//                    LoadingInfo(getCurrentIndex(goods_id, '#productTbody', 'tr[class="tr-title"]'));
//                    $("#dialog").dialog({
//                        buttons: {
//                            "确定": function () {
//                                $(this).dialog('close');
//                            }
//                        },
//                        contentText: data["message"],
//                        title: "消息提醒",
//                    });
//                }
//            }
//        })
//    }
//
//    //撤销内购
//    function modifyGoodsOffInside(goods_ids) {
//        $.ajax({
//            type: "post",
//            url: "{:__URL('ADMIN_MAIN/Goods/modifyGoodsOffInside')}",
//            data: {"goods_ids": goods_ids},
//            success: function (data) {
//                if (data["code"] > 0) {
//                    LoadingInfo(getCurrentIndex(goods_ids, '#productTbody', 'tr[class="tr-title"]'));
//                    $("#dialog").dialog({
//                        buttons: {
//                            "确定": function () {
//                                $(this).dialog('close');
//                            }
//                        },
//                        contentText: "撤销成功",
//                        title: "消息提醒",
//                        time: 3
//                    });
//                }
//            }
//        })
//    }

    //显示分润设置
    function showFraction() {
        var goods_ids = "";
        $("#productTbody input[type='checkbox']:checked").each(function () {
            if (!isNaN($(this).val())) {
                goods_ids = $(this).val() + "," + goods_ids;
            }
        });
        goods_ids = goods_ids.substring(0, goods_ids.length - 1);
        if (goods_ids == "") {
            $("#dialog").dialog({
                buttons: {
                    "确定": function () {
                        $(this).dialog('close');
                    }
                },
                contentText: "请选择需要操作的记录",
                title: "消息提醒",
            });
            return false;
        }
        $("#goods_type_ids").val(goods_ids);
        $("#setFraction").popover("show");
    }

    //隐藏分润设置
    function hideSetFraction() {
        $("#setFraction").popover("hide");
    }

    //分润设置
    function setFraction() {
        var goods_ids = $("#goods_type_ids").val();
        var fraction = $("#fractionValue input[type='number']").val();
        if (fraction == "" || fraction < 0 || fraction > 50) {
            $("#dialog").dialog({
                buttons: {
                    "确定": function () {
                        $(this).dialog('close');
                    }
                },
                contentText: "分润比率必须为0-50的正整数",
                title: "消息提醒",
            });
            return false;
        }
        $.ajax({
            type: "post",
            url: "{:__URL('ADMIN_MAIN/goods/modifygoodsFraction')}",
            data: {
                "goods_id": goods_ids,
                "fraction": fraction
            },
            success: function (data) {
                if (data["code"] > 0) {
                    $("#setFraction").popover("hide");
                    LoadingInfo(getCurrentIndex(goods_ids, '#productTbody', 'tr[class="tr-title"]'));
                    $("#dialog").dialog({
                        buttons: {
                            "确定": function () {
                                $(this).dialog('close');
                            }
                        },
                        contentText: data["message"],
                        title: "消息提醒",
                    });
                }
            }
        })
    }

    //显示 推荐选项
    function ShowRecommend() {
        var goods_ids = "";
        $("#productTbody input[type='checkbox']:checked").each(function () {
            if (!isNaN($(this).val())) {
                goods_ids = $(this).val() + "," + goods_ids;
            }
        });
        goods_ids = goods_ids.substring(0, goods_ids.length - 1);
        if (goods_ids == "") {
            $("#dialog").dialog({
                buttons: {
                    "确定": function () {
                        $(this).dialog('close');
                    }
                },
                contentText: "请选择需要操作的记录",
                title: "消息提醒",
            });
            return false;
        }
        $("#goods_type_ids").val(goods_ids);
        $("#setRecommend").popover("show");
    }

    $("#recommendType label,#recommendType label input").live("click", function () {
        if ($(this).children("input").is(":checked")) {
            $(this).children("input").prop("checked", false);
        } else {
            $("#recommendType label input").prop("checked", false);
            $(this).children("input").prop("checked", true);
        }
    })

    //修改为  推荐 商品
    function setRecommend() {
        var recommend_type = '';
        var goods_ids = $("#goods_type_ids").val();
        $("#recommendType input[type='checkbox']").each(function () {
            if ($(this).attr("checked") == 'checked') {
                var recommend_type_new = 1;
            } else {
                var recommend_type_new = 0;
            }
            recommend_type = recommend_type_new + "," + recommend_type;
        })
        if (recommend_type == "") {
            $("#dialog").dialog({
                buttons: {
                    "确定": function () {
                        $(this).dialog('close');
                    }
                },
                contentText: "请选择需要操作的记录",
                title: "消息提醒",
            });
            return false;
        }
        recommend_type = recommend_type.substring(0, recommend_type.length - 1);
        $.ajax({
            type: "post",
            url: "{:__URL('ADMIN_MAIN/goods/modifygoodsrecommend')}",
            data: {
                "goods_id": goods_ids,
                "recommend_type": recommend_type
            },
            success: function (data) {
                if (data["code"] > 0) {
                    $("#setRecommend").popover("hide");
                    LoadingInfo(getCurrentIndex(goods_ids, '#productTbody', 'tr[class="tr-title"]'));
                    $("#dialog").dialog({
                        buttons: {
                            "确定": function () {
                                $(this).dialog('close');
                            }
                        },
                        contentText: data["message"],
                        title: "消息提醒",
                    });
                }
            }
        })
    }

    $("#goodsCategoryOne").click(function () {
        var isShow = $("#goodsCategoryOne").attr('is_show');
        if (isShow == "false") {
            $(".one").show();
            $(".selectGoodsCategory").css({
                'width': 159,
                'right': 580
            });
            $(".selectGoodsCategory").show();
            $("#goodsCategoryOne").attr('is_show', 'true');
            $(".js-mask-category").show();
        } else {
            $(".one").hide();
            $(".two").hide();
            $(".three").hide();
            $(".selectGoodsCategory").css({
                'width': 159,
                'right': 580
            });
            $(".selectGoodsCategory").hide();
            $("#goodsCategoryOne").attr('is_show', 'false');
        }
    });

    $(".js-mask-category").click(function () {
        $(".one").hide();
        $(".selectGoodsCategory").hide();
        $(".two").hide();
        $(".three").hide();
        $("#goodsCategoryOne").attr('is_show', 'false');
        $(this).hide();
    });

    $(".js-category-one").click(function () {
        parentId = $(this).attr("category_id");
        category_name = $(this).text();
        $(".one ul li").not($(this)).removeClass("selected");
        $(this).addClass("selected");
        $("#goodsCategoryOne").val($.trim(category_name) + ">");
        $("#category_id_1").val(parentId);
        $("#category_id_2").val('');
        $("#category_id_3").val('');
        $.ajax({
            type: 'post',
            url: "{:__URL('ADMIN_MAIN/goods/getcategorybyparentajax')}",
            data: {"parentId": parentId},
            success: function (data) {
                if (data.length > 0) {
                    var html = '';
                    for (var i = 0; i < data.length; i++) {
                        html += '<li class="js-category-two" category_id="' + data[i]['category_id'] + '">' + data[i]['category_name'];
                        if (data[i]['is_parent'] == 1) {
                            html += '<i class="fa fa-angle-right fa-lg"></i>';
                        }
                        html += '</li>';
                    }
                    $("#goodsCategoryTwo").html(html);
                    $(".two").show();
                    $(".selectGoodsCategory").css({
                        'width': 319,
                        'right': 361
                    });
                } else {
                    $(".one").hide();
                    $(".two").hide();
                    $(".js-mask-category").hide();
                    $(".selectGoodsCategory").hide();
                    $("#goodsCategoryOne").attr('is_show', 'false');
                }
                $(".three").hide();
            }
        });
        return false;
    });

    $(".js-category-two").live("click", function (event) {
        var parentId = $(this).attr("category_id");
        var category_name = $(this).text();
        $(".two ul li").not($(this)).removeClass("selected");
        $(this).addClass("selected");
        var goodsCategoryOne = $("#goodsCategoryOne").val();
        $("#goodsCategoryOne").val(goodsCategoryOne + '' + category_name + '>');
        $("#category_id_2").val(parentId);
        $("#category_id_3").val('');
        $.ajax({
            type: 'post',
            url: "{:__URL('ADMIN_MAIN/goods/getcategorybyparentajax')}",
            data: {"parentId": parentId},
            success: function (data) {
                if (data.length > 0) {
                    var html = '';
                    for (var i = 0; i < data.length; i++) {
                        html += '<li onclick="goodsCategoryThree(this);" category_id="' + data[i]['category_id'] + '">' + data[i]['category_name'] + '<i class="fa fa-angle-right fa-lg"></i></li>';
                    }
                    $("#goodsCategoryThree").html(html);
                    $(".three").show();
                    $(".selectGoodsCategory").css({
                        'width': 480,
                        'right': 162
                    });
                } else {
                    $(".one").hide();
                    $(".two").hide();
                    $(".three").hide();
                    $(".selectGoodsCategory").hide();
                    $(".js-mask-category").hide();
                    $("#goodsCategoryOne").attr('is_show', 'false');
                }
            }
        })
        event.stopPropagation();
    });

    function goodsCategoryThree(obj) {
        var parentId = $(obj).attr("category_id");
        var category_name = $(obj).text();
        $(".three ul li").not($(obj)).removeClass("selected");
        $(obj).addClass("selected");
        var goodsCategoryOne = $("#goodsCategoryOne").val();
        $("#goodsCategoryOne").val(goodsCategoryOne + '' + category_name);
        $("#category_id_3").val(parentId);
        $(".one").hide();
        $(".two").hide();
        $(".three").hide();
        $(".selectGoodsCategory").hide();
        $(".js-mask-category").hide();

        $(".selectGoodsCategory").css({
            'width': 218,
            'right': 580
        });
        $("#goodsCategoryOne").attr('is_show', 'false');
    }

    $("#confirmSelect").click(function () {
        $(".one").hide();
        $(".two").hide();
        $(".three").hide();
        $(".selectGoodsCategory").hide();
        $(".selectGoodsCategory").css({
            'width': 218,
            'right': 580
        });
    })



//    $("#category_click").click(function () {
//        $("#category_click").
//        console.log(111);return;
//
//    })

    function batchCopyGoods() {
        var goods_ids = new Array();
        $("#productTbody input[type='checkbox']:checked").each(function () {
            if (!isNaN($(this).val())) {
                goods_ids.push($(this).val());
            }
        });

        if (goods_ids.length == 0) {
            $("#dialog").dialog({
                buttons: {
                    "确定,#e57373": function () {
                        $(this).dialog('close');
                    }
                },
                contentText: "请选择需要操作的记录",
                title: "消息提醒",
            });
            return false;
        }

        $("#batchCopyGoodsSubmit").modal("show");
        $("#goods_ids").val(goods_ids);
    }

    var flag = false;
    function batchCopyGoodsSubmit(){
        var goods_ids = $("#goods_ids").val();
        var category_id1 = $("#category_id1").val();
        var name_add_type = $("input[name='name_add_type']:checked").val();
        var name = $("#name").val();

        if(category_id1 == ""){
            showTip("请选择分类","warning");
            $("#category_id1").focus();
            return;
        }

        if(name == ""){
            showTip("专属名称不能为空","warning");
            $("#name").focus();
            return;
        }

        if (flag) {
            return;
        }
        flag = true;

        $.ajax({
            type : "post",
            url : "{:__URL('ADMIN_MAIN/goods/batchCopyGoods')}",
            data : {
                'goods_ids':goods_ids,
                'category_id1' :category_id1,
                'name_add_type' : name_add_type,
                'name' : name
            },
            success : function(data) {
                if (data['code'] > 0) {
                    showTip(data['message'],'success');
                    LoadingInfo(getCurrentIndex(goods_ids, '#productTbody', 'tr[class="tr-title"]'));
                    $("#batchCopyGoodsSubmit").modal("hide");
                } else {
                    showTip(data['message'],'error');
                    flag = false;
                }
            }
        });
    }

    function copyGoodsDetail(goods_id) {
        $("#dialog").dialog({
            buttons: {
                "确定": function () {
                    $.ajax({
                        type: "post",
                        url: "{:__URL('ADMIN_MAIN/goods/copygoods')}",
                        data: {"goods_id": goods_id},
                        dataType: "json",
                        success: function (data) {
                            if (data["code"] > 0) {
                                LoadingInfo(getCurrentIndex(goods_id, '#productTbody', 'tr[class="tr-title"]'));
                                $("#dialog").dialog({
                                    buttons: {
                                        "确定": function () {
                                            $(this).dialog('close');
                                        }
                                    },
                                    modal: true,
                                    contentText: data["message"],
                                    title: "消息提醒",
                                    time: 1
                                });
                                $("#chek_all").prop("checked", false);
                            }
                        }
                    });
                    $(this).dialog('close');
                },
                "取消,#e57373": function () {
                    $(this).dialog('close');
                },
            },
            contentText: "确定要复制一条新的商品信息吗？",
        });
    }

    function changeSort(event) {
        var sort = parseInt($(event).val());
        $(event).val(sort);
        var goods_id = $(event).attr("goods_id");
        $.ajax({
            type: "post",
            url: "{:__URL('ADMIN_MAIN/goods/updateGoodsSortAjax')}",
            data: {"sort": sort, "goods_id": goods_id},
            success: function (data) {
                if (data.code > 0) {
                    LoadingInfo(getCurrentIndex(goods_id, '#productTbody', 'tr[class="tr-title"]'));
                    showTip(data.message, "success");
                } else {
                    showTip(data.message, "error");
                }
            }
        })
    }

    //更新二维码
    function batchUpdateGoodsQrcode() {
        var goods_ids = new Array();
        $("#productTbody input[type='checkbox']:checked").each(function () {
            if (!isNaN($(this).val())) {
                goods_ids.push($(this).val());
            }
        });
        if (goods_ids.length == 0) {
            showMessage("error", "请至少选择一件商品");
            return false;
        }
        $.ajax({
            type: "post",
            url: "{:__URL('ADMIN_MAIN/goods/updateGoodsQrcode')}",
            data: {"goods_id": goods_ids.toString()},
            success: function (data) {
                if (data["code"] > 0) {
                    LoadingInfo(getCurrentIndex(goods_ids, '#productTbody', 'tr[class="tr-title"]'));
                    showMessage('success', '二维码更新成功');
                } else {
                    showMessage('error', data['message']);
                }
            }
        })
    }

    function selectGoodsLabel() {
        $("#selectGoodsLabel").popover("show");
        $("#selectGoodsLabelId").val('');
        $("#selectGoodsLabel").val('');
    }

    function hideGroup() {
        $("#selectGoodsLabel").popover("hide");
        $("#selectGoodsLabel").val('');
    }
    function change() {
        $(".pro_share").css("display", "block")
    }
    function clickGoodsLabel(event) {
        var goods_label_id = $(event).val();
        var goods_label_name = $(event).next("span").text();
        var selectGoodsLabelVal = $("#selectGoodsLabel").val();
        var selectGoodsLabelId = $("#selectGoodsLabelId").val();
        if ($(event).is(":checked")) {
            $("#selectGoodsLabelId").val(selectGoodsLabelId + goods_label_id + ',');
            $("#selectGoodsLabel").val(selectGoodsLabelVal + goods_label_name + ';');
        } else {
            selectGoodsLabelVal = selectGoodsLabelVal.replace(goods_label_name + ';', '');
            selectGoodsLabelId = selectGoodsLabelId.replace(goods_label_id + ',', '');
            $("#selectGoodsLabelId").val(selectGoodsLabelId);
            $("#selectGoodsLabel").val(selectGoodsLabelVal);
        }
    }

    $(function () {
        var rot = $([])


        for (var i = 0; i < rot.length; i++) {
            rot[i].index = i;//此处为难点，意思是给每一个按钮设置一个index属性
            console.log(rot[i]);
            rot[i].onclick = function () {
                console.log(111);
            }
        }
    })


    function confirm() {
        $("#selectGoodsLabel").popover("hide");
    }

    function editGoodsInfo(event) {
        $(event).hide();
        $(event).next("input").show().focus();
    }
    // 点击显示更多搜索
    $(".more_search").click(function () {
        $("#more_search").slideToggle();
    })


    // 修改库存
    function changeStock(event) {
        var stock = parseInt($(event).val());
        $(event).val(stock);
        var goods_id = $(event).attr("goods_id");
        $.ajax({
            type: "post",
            url: "{:__URL('ADMIN_MAIN/goods/updateGoodsStockAjax')}",
            data: {"stock": stock, "goods_id": goods_id},
            success: function (data) {
                if (data.code > 0) {
                    LoadingInfo(getCurrentIndex(goods_id, '#productTbody', 'tr[class="tr-title"]'));
                    showTip(data.message, "success");
                } else {
                    showTip(data.message, "error");
                }
            }
        })
    }


</script>
{/block}
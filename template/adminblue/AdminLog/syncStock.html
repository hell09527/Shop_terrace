{extend name="adminblue/base" /}
{block name="resources"/}
<link rel="stylesheet" type="text/css" href="ADMIN_CSS/product.css">
<style type="text/css">
    table{
        font-size: 13px;
    }
    .num{
        width: 40px;
        text-align: center;
    }
    .text-p{
        width: 80%;
        margin-right: 20px;
    }
    .text-p>p{
        text-align: left;
    }
    #code_show{
        width: 200px;
        height: 200px;
        position: fixed;
        left: 45%;
        top: 30%;
        display: none
    }
    #motai-div{min-width: 60%;}

</style>
{/block}
{block name="main"}
<div id="code_show"></div>
<table class="table-class">
    <colgroup>
        <col style="width: 20%;">
        <col style="width: 20%;">
        <col style="width: 20%;">
        <col style="width: 10%;">
        <col style="width: 20%;">
        <col style="width: 10%;">
    </colgroup>
    <thead>
    <tr align="center">
        <th align="center">创建时间</th>
        <th align="center">货流id</th>
        <th align="center">备注</th>
        <th align="center">线下操作</th>
        <th align="center">结果</th>
        <th align="center">详情</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" id="motai-div" aria-labelledby="myLargeModalLabel"></div>

{/block}
{block name="script"}
<script type="text/javascript">
    function LoadingInfo(page_index) {
        $.ajax({
            type : "post",
            url : "{:__URL('ADMIN_MAIN/pospal/syncStock')}",
            data : { "page_index" : page_index, "page_size" : $("#showNumber").val() },
            success : function(data) {
                var html = '';
                if (data['data'].length > 0) {
                    for (var i = 0; i < data['data'].length; i++) {
                        html += '<tr align="center">';
                        html += '<td align="center">' + timeStampTurnTime(data['data'][i]["created"]) + '</td>';
                        html += '<td align="center">' + data['data'][i]['stock_flow_id'] + '</td>';
                        html += '<td align="center">' + data['data'][i]['remark'] + '</td>';
                        if(data['data'][i]['return_code'] == '0'){
                            html += '<td align="center" style="color: black"> 待处理 </td>';
                        }else if(data['data'][i]['return_code'] == '1'){
                            html += '<td align="center" style="color: forestgreen"> 已接收 </td>';
                        }else if(data['data'][i]['return_code'] == '2'){
                            html += '<td align="center" style="color: indianred"> 已拒绝 </td>';
                        }else{
                            html += '<td align="center" style="color: forestgreen"> 已编辑 </td>';
                        }
                        if(data['data'][i]['status'] == 'success'){
                            html += '<td align="center" style="color: forestgreen">' + data['data'][i]['status'] + '</td>';
                        }else{
                            html += '<td align="center" style="color: indianred">' + data['data'][i]['status'] +'<br> 错误码：'+ data['data'][i]['err_code']+'</td>';
                        }
                        html +='<td><button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#motai-div" onclick = "seeDetail('+ data['data'][i]['stock_flow_id'] +','+ data['data'][i]['id'] +')" >查看详情</button></td>';
                        html += '</tr>';
                    }
                } else {
                    html += '<tr align="center"><td colspan="6">暂无记录</td></tr>';
                }
                $(".table-class tbody").html(html);
                initPageData(data["page_count"],data['data'].length,data['total_count']);
                $("#pageNumber").html(pagenumShow(jumpNumber,$("#page_count").val(),{$pageshow}));
            }
        });
    }

    //查看详情
	function seeDetail(stock_flow_id,id){
	    var stock_flow_id = stock_flow_id;
	    var id            = id;
        var html = '';
        $.ajax({
			type : "post",
			url : "{:__URL('ADMIN_MAIN/pospal/seeDetail')}",
			data : {
				"stock_flow_id" : stock_flow_id,
				"id" : id
			},
			success : function(data) {
			    if(stock_flow_id){
                    html += '<div class="modal-dialog modal-lg" role="document">';
                    html += '<div class="modal-content">';
                    html += '<div class="modal-header">';
                    html += '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>';
                    html += '<h4 class="modal-title" id="myModalLabel">货流详情</h4>';
                    html += '</div>';
                    html += '<div class="modal-body">';
                    html += '<table class="table table-bordered table-class">';
                    html += '<thead>';
                    html += '<tr>';
                    html += '<th>商品名称</th>';
                    html += '<th>shopal编码</th>';
                    html += '<th>条形码</th>';
                    html += '<th>库存变动</th>';
                    html += '</tr>';
                    html += '</thead>';
                    html += '<tbody>';
                    if (data.length > 0) {
                        for (var i = 0; i < data.length; i++) {
                            html += '<tr>';
                            html += '<td>' + data[i]['product_name'] + '</td>';
                            html += '<td>' + data[i]['product_code'] + '</td>';
                            html += '<td>' + data[i]['barcode'] + '</td>';
                            html += '<td>' + data[i]['update_stock'] + '</td>';
                            html += '</tr>';
                        }
                        html += '</tbody>';
                        html += '</table>';
                        html += '</div>';
                        html += '<div class="modal-footer">';
                        html += '<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                    }
			    }else{
			        html += '<div class="modal-dialog modal-lg" role="document">';
                    html += '<div class="modal-content">';
                    html += '<div class="modal-header">';
                    html += '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>';
                    html += '<h4 class="modal-title" id="myModalLabel">货流详情</h4>';
                    html += '</div>';
                    html += '<div class="modal-body">';
                    html += '<table class="table table-bordered table-class">';
                    html += '<thead>';
                    html += '<tr>';
                    html += '<th>错误信息:</th>';
                    html += '<th>' + data[0]['err_msg'] + '</th>';
                    html += '</tr>';
                    html += '</thead>';
                    html += '<tbody>';
			    }

			    $("#motai-div").html(html);
		    }
		})
	}
</script>
{/block}
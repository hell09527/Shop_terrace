{extend name="adminblue/base" /}
{block name="resources"/}
<link rel="stylesheet" type="text/css" href="ADMIN_CSS/product.css">
<style type="text/css">
    .num{
        width: 40px;
        text-align: center;
    }
    .text-p{
        width: 80%;
        margin-right: 20px;
    }
    .text-p>p{
        text-align: left;
    }
    #code_show{
        width: 200px;
        height: 200px;
        position: fixed;
        left: 45%;
        top: 30%;
        display: none
    }
</style>
{/block}
{block name="main"}
<div id="code_show"></div>
<table class="mytable">
    <tr>
        <th width="50%" style="text-align: left;">
            <!--<button class="btn-common-delete btn-small" onclick="batchDelete()" style="margin:0 5px 0 0 !important;">批量锁定</button>-->
            <button class="btn-common btn-small" onclick="location.href='{:__URL('ADMIN_MAIN/member/memberList?type=1')}';" style="margin:0 5px 0 0 !important;">添加极选师</button>
        </th>
        <th width="20%">
            <input type="text" id='search_text' placeholder="输入姓名/会员昵称/手机号" class="input-common" />
            <input type="button" onclick="searchData()" value="搜索" class="btn-common" />
        </th>
    </tr>
</table>
<table class="table-class">
    <colgroup>
        <col style="width: 2%">
        <col style="width: 30%;">
        <col style="width: 10%;">
        <col style="width: 10%;">
        <col style="width: 10%;">
        <col style="width: 10%;">
        <col style="width: 10%;">
        <col style="width: 10%;">
    </colgroup>
    <thead>
    <tr align="center">
        <th><input id="ckall" type="checkbox" onClick="CheckAll(this)"></th>
        <th align="center">申请人信息</th>
        <th align="center">申请极选师类型</th>
        <th align="center">推荐人</th>
        <th align="center">邀请人</th>
        <th>状态</th>
        <th>申请时间</th>
        <th>操作</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>
{/block}
{block name="script"}
<script type="text/javascript">
    $('.num').live("change",function(){
        var fieldid = $(this).attr('fieldid');
        var sort = $(this).val();
        $.ajax({
            type:"post",
            url:"{:__URL('ADMIN_MAIN/cms/modifyarticlefield')}",
            data:{'fieldid':fieldid,'sort':sort},
            success: function (data) {
                if(data['code'] > 0){
                    showTip("修改成功","success");
                    LoadingInfo(getCurrentIndex(fieldid,'.table-class tbody'));
                }else{
                    showTip("修改失败","error");
                }
            }
        });
    });

    function batchDelete() {
        var article_id= new Array();
        $(".table-class tbody input[type='checkbox']:checked").each(function() {
            if (!isNaN($(this).val())) {
                article_id.push($(this).val());
            }
        });
        if(article_id.length ==0){
            $( "#dialog" ).dialog({
                buttons: {
                    "确定,#e57373": function() {
                        $(this).dialog('close');
                    }
                },
                contentText:"请选择需要操作的记录",
                title:"消息提醒",
            });
            return false;
        }
        deleteArticle(article_id);
    }

    $("body").click(function(){
        $("#code_show").hide();
        $('#code_img').remove();
    });

    //锁定
    var flag = false;
    function checkKolStatus(uid){
        $( "#dialog" ).dialog({
            buttons: {
                "确定": function() {
                    $(this).dialog('close');
                    if(!flag){
                        flag = true;
                        $.ajax({
                            type : "post",
                            url : "{:__URL('ADMIN_MAIN/kol/checkKolStatus')}",
                            data : { "uid" : uid.toString() },
                            dataType : "json",
                            success : function(data) {
                                if (data["code"] > 0) {
                                    showMessage('success', data["msg"]);
                                    LoadingInfo(getCurrentIndex(article_id,'.table-class tbody'));
                                }else{
                                    showMessage('error', data["msg"]);
                                    flag = false;
                                }
                            }
                        })
                    }
                },
                "取消,#e57373": function() {
                    $(this).dialog('close');
                }
            },
            contentText:"确定执行该操作？",
        });
    }

    //分页数据
    function LoadingInfo(page_index) {
        var search_text = $("#search_text").val();
        $.ajax({
            type : "post",
            url : "{:__URL('ADMIN_MAIN/distributor/kolApplyList')}",
            data : { "page_index" : page_index, "page_size" : $("#showNumber").val(), "search_text" : search_text },
            success : function(data) {
                var html = '';
                if (data["data"].length > 0) {
                    for (var i = 0; i < data["data"].length; i++) {
                        html += '<tr align="center">';
                        html += '<td><input name="sub" type="checkbox" value="'+ data['data'][i]['uid']+'" ></td>';
                        html += '<td><span style=" border-radius:50%; overflow:hidden;width: 120px;float:left;"><img src='+__IMG(data["data"][i]["user_headimg"])+' style="width:80px;height:80px;border-radius: 50%;"/></span><div class="text-p"><p>姓名：' + data["data"][i]["real_name"]+ '</p><p>昵称：' + data["data"][i]["nick_name"]+ '</p><p>手机：' + data["data"][i]["user_tel"]+ '</p></div></td>';
                        html += '<td align="center">' + '签约极选师' + '</td>';
                        if(data["data"][i]["recommend_user_name"] == null){
                            html += '<td align="center"> 无 </td>';
                        }else{
                            html += '<td align="center">' + data["data"][i]["recommend_user_name"] + '</td>';
                        }
                        if(data["data"][i]["inviter_user_name"] == null){
                            html += '<td align="center"> 无 </td>';
                        }else{
                            html += '<td align="center">' + data["data"][i]["inviter_user_name"] + '</td>';
                        }
                        if(data["data"][i]["is_check"]==0){
                            html += '<td>待审核<br/>';
                        }else if(data["data"][i]["is_check"]==1){
                            html += '<td style="color: forestgreen">审核通过<br/>';
                        }else{
                            html += '<td style="color: indianred">审核未通过<br/>';
                        }
                        html += '<td align="center">' + data["data"][i]["created_time"] + '</td>';
                        if(data["data"][i]["is_check"]==1 || data["data"][i]["is_check"]==2){
                            html += '<td><a style="cursor: pointer;" href="'+__URL('ADMIN_MAIN/distributor/applyDetail?id='+data["data"][i]['id'])+'">查看资料</a><br/>';
                        }else{
                            html += '<td><a style="cursor: pointer;" href="'+__URL('ADMIN_MAIN/distributor/applyDetail?id='+data["data"][i]['id'])+'">审核资料</a><br/>';
                        }
                        html += '</tr>';
                    }
                } else {
                    html += '<tr align="center"><td colspan="9">暂无申请信息</td></tr>';
                }
                $(".table-class tbody").html(html);
                initPageData(data["page_count"],data['data'].length,data['total_count']);
                $("#pageNumber").html(pagenumShow(jumpNumber,$("#page_count").val(),{$pageshow}));
            }
        });
    }




    //全选
    function CheckAll(event){
        var checked = event.checked;
        $(".table-class tbody input[type = 'checkbox']").prop("checked",checked);
    }

    //搜索
    function searchData(){
        LoadingInfo(1);
    }

    //小程序码
    function showCode(uid){
        $.ajax({
            type : "post",
            url : "{:__URL('ADMIN_MAIN/Distributor/getWxCode')}",
            data : {
                "uid" : uid.toString()
            },
            dataType : "json",
            success : function(data) {
                if (data["code"] = 1) {
                    $("#code_show").show();
                    $("#code_show").append(
                            '<image id="code_img" src="'+data.url+'">'
                    );
                } else {

                }
            }
        })
    }
</script>
{/block}
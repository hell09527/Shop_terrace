{extend name="adminblue/base" /}
{block name="resources"/}
<link rel="stylesheet" type="text/css" href="ADMIN_CSS/product.css">
<style type="text/css">
	.num{
		width: 40px;
		text-align: center;
	}
	.text-p{
		width: 80%;
		margin-right: 20px;
	}
	.text-p>p{
		text-align: left;
	}
	#code_show{
		width: 200px;
		height: 200px;
		position: fixed;
		left: 45%;
		top: 30%;
		display: none
	}
	.table-bordered .ts-border tr td{
		text-align: center;
		vertical-align: middle;
	}
	textarea{
		width:515px;
		max-width:600px;
		height:135px;
		max-height:150px;
		overflow-y:auto;
		resize: none;
	}
	.modal-img{
		text-align: center;
		padding: 10px;
		margin-top: 10px;
	}


</style>
{/block}
{block name="main"}
<div id="code_show"></div>
<div class="bs-example" data-example-id="bordered-table">
	<table class="table table-bordered" style="table-layout:fixed;" id="item">
		<thead>
		<tr style="background-color: #e4f2ff">
			<td colspan="6" class="tr-first">极选师申请表<button type="button" class="btn btn-default" style="float: right;height: 24px;line-height: 15px;font-size: 10px;" onclick="tableToExcel('item','item2','kolApply')">导出数据</button>
			</td>
		</tr>
		</thead>
		<thead class="ts-border">
		<tr>
			<td>姓名</td>
			<td>{$apply['name']}</td>
			<td>性别</td>
			<td>{$apply['sex'] == 1 ? '男' : '女'}</td>
			<td>出生日期</td>
			<td>{$apply['birthday']}</td>
		</tr>
		<tr>
			<!--<td>民族</td>-->
			<!--<td>{$apply['nation']}</td>-->
			<!--<td>银行卡信息</td>-->
			<!--<td>-->
				<!--{if condition="$apply['auth_show_type'] == '1' || $apply['auth_show_type'] == '2' || $apply['auth_show_type'] == '3'"}-->
				<!--<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModalId" onclick = "updateIMG(1)">查看银行卡照片</button>-->
				<!--{else/}-->
				<!--<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModalId"  disabled="true">查看银行卡照片</button>-->
				<!--{/if}-->
			<!--</td>-->
			<td>身份信息</td>
			{if condition="$apply['id_face_pros'] != ''"}
			<td colspan="5">
				{if condition="$apply['auth_show_type'] == '1' || $apply['auth_show_type'] == '3'"}
				<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal" onclick = "updateIMG()" >查看身份证照片</button>
				{else/}
				<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal"  disabled="true">查看身份证照片</button>
				{/if}
			</td>
			{else/}
			<td colspan="5">
			<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal"  disabled="true">暂无身份证信息</button>
			</td>
			{/if}
		</tr>
		<tr>
			<td>申请类型</td>
			<td>签约极选师</td>
			<td>手机号</td>
			<td>{$apply['tel']}</td>
			<td>Email</td>
			<td>{$apply['email']}</td>
		</tr>
		<tr>
			<td>现住址</td>
			<td colspan="5">{$apply['province']}{$apply['city']}{$apply['district']}{$apply['address']}</td>
		</tr>
		<!--<tr>-->
			<!--<td>银行卡开户行</td>-->
			<!--<td colspan="2">{$apply['bank_name']}|{$apply['bank_open_name']}</td>-->
			<!--<td>银行卡账号</td>-->
			<!--<td colspan="2">{$apply['bank_account_number']}</td>-->
		<!--</tr>-->
		<!--<tr>-->
			<!--<td  rowspan="3">经历爱好</td>-->
			<!--<td>教育经历</td>-->
			<!--<td colspan="4">{$apply['educational_experience']}</td>-->
		<!--</tr>-->
		<tr>
			<td>工作经历</td>
			<td colspan="5">{$apply['work_experience']}</td>
		</tr>
		<tr>
			<!--<td>兴趣特长</td>-->
			<!--<td colspan="4">{$apply['hobbies']}</td>-->
		</tr>
		<!--<tr>-->
			<!--<td>流量入口及方向</td>-->
			<!--<td colspan="5">{$apply['describe1']}</td>-->
		<!--</tr>-->
		<!--<tr>-->
			<!--<td>眼中的Bonnie&Clyde</td>-->
			<!--<td colspan="5">{$apply['describe2']}</td>-->
		<!--</tr>-->
		<!--<tr>-->
			<!--<td>为何选择做极选师</td>-->
			<!--<td colspan="5">{$apply['describe3']}</td>-->
		<!--</tr>-->
		</thead>
	</table>
</div>
<div class="bs-example" data-example-id="bordered-table">
	<table class="table table-bordered" style="table-layout:fixed;" id="item2">
		<thead>
		<tr style="background-color: #e4f2ff"><td colspan="6"><span style="float: left">审核意见</span><span style="float: right">审核状态：{$apply['check_status']}</span></td></tr>
		</thead>
		<thead class="ts-border">
		<tr>
			<td colspan="1">业绩预估（元）</td>
			<td colspan="1">{$apply['estimate_money']}</td>
			<td colspan="1">推荐人</td>
			{if condition="$apply['recommend_user_name'] != ''"}
			<td colspan="1">{$apply['recommend_user_name']}</td>
			{else/}
			<td colspan="1">无</td>
			{/if}
			<td colspan="1">邀请人</td>
			{if condition="$apply['inviter_user_name'] != ''"}
			<td colspan="1">{$apply['inviter_user_name']}</td>
			{else/}
			<td colspan="1">无</td>
			{/if}
		</tr>
		<tr>
			<td colspan="1" style="vertical-align: middle">审核意见</td>
			<td colspan="5">
				{if condition="$apply['check_info_2'] != ''"}
				{$apply['check_info_2']['desc']}<br>
				{if condition="$apply['check_info_2']['is_check'] == '1'"}
				<span style="width: 24%;color: yellowgreen;float: right">通过</span>
				{else/}
				<span style="width: 24%;color: red;float: right">未通过</span>
				{/if}
				<br>
				<div>
					<p style="text-align: right">审核人：{$apply['check_info_2']['check_user']} | 审核时间：{$apply['check_info_2']['created_time']}</p>
				</div>
				{else/}
				{if condition="$apply['auth_show_type'] == '1' || $apply['auth_show_type'] == '3'"}
				<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal1" data-whatever="@mdo">审核</button>
				{else/}
				<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal1" data-whatever="@mdo" disabled="true">审核</button>
				{/if}
				{/if}
			</td>
		</tr>
		</thead>
	</table>
</div>

<!--模态框1-->
<div class="modal fade" id="exampleModal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1" style="display: none">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="exampleModalLabel1">审核意见</h4>
			</div>
			<div class="modal-body">
				<form>
					<div class="form-group">
						<textarea class="form-control" id="message-text1"></textarea>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary" onclick="sendView({$apply['id']},1,2)">同意申请</button>
				<button type="button" class="btn btn-warning" onclick="sendView({$apply['id']},2,2)">不同意</button>
			</div>
		</div>
	</div>
</div>
<!--模态框end-->
<!--模态框2-->
<div class="modal fade" id="exampleModal2" tabindex="-1" role="dialog" aria-labelledby="exampleModal2" style="display: none">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="exampleModalLabel2">审核意见</h4>
			</div>
			<div class="modal-body">
				<form>
					<div class="form-group">
						<textarea class="form-control" id="message-text2"></textarea>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary" onclick="sendView({$apply['id']},1,1)">同意申请</button>
				<button type="button" class="btn btn-warning" onclick="sendView({$apply['id']},2,1)">不同意</button>
			</div>
		</div>
	</div>
</div>
<!--模态框end-->
<!--查看银行卡-->
<div class="modal fade" id="myModalId" tabindex="-1" role="dialog" aria-labelledby="myModalLabel1" style="display: none" >
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="myModalLabel1">银行卡照片</h4>
			</div>
			<div class="modal-body">
				<div class="modal-img">
					<img src="{$apply['bank_card_pic']}" alt="银行卡" class="img-thumbnail" id="bank_img">
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
				<button class="btn btn-default"  id="bank_button">旋转图片</button>
				<!--<button type="button" class="btn btn-primary" onclick = "downBankPic()">下载图片</button>-->
				<!--<a href="{$apply['id_face_pros']}" download="1.jpg">下载图片</a>-->
				<!--<a href="{$apply['id_face_cons']}" download="2.jpg">下载图片</a>-->
				<!--<a href="javascript:;" class="btn btn-primary" id="down_btn_a">点击下载</a>-->
			</div>
		</div>
	</div>
</div>
<!--模态框end-->
<!--查看身份证-->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="display: none">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="myModalLabel">身份证照片</h4>
			</div>
			<div class="modal-body">
				<div class="modal-img">
					<img src="{$apply['id_face_pros']}" alt="正" class="img-thumbnail" id="img1">
				</div>
				<div class="modal-img">
					<img src="{$apply['id_face_cons']}" alt="反" class="img-thumbnail" id="img2">
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
				<button class="btn btn-default"  id="icon_1_img">旋转图片</button>
				<button class="btn btn-default"  id="icon_2_img">旋转图片</button>
				<!--<button type="button" class="btn btn-primary" onclick = "downPic()">下载图片</button>-->
				<!--<a href="{$apply['id_face_pros']}" download="1.jpg">下载图片</a>-->
				<!--<a href="{$apply['id_face_cons']}" download="2.jpg">下载图片</a>-->
				<!--<a href="javascript:;" class="btn btn-primary" id="down_btn_a">点击下载</a>-->
			</div>
		</div>
	</div>
</div>
<!--模态框end-->
{/block}
{block name="script"}
<script type="text/javascript">
	//审核回复
	function sendView(id,is_check,click_origin){
		if(click_origin == 1){
			var desc = $('#message-text2').val();
		}else{
			var desc = $('#message-text1').val();
		}
		$.ajax({
			type : "post",
			url : "{:__URL('ADMIN_MAIN/Distributor/sendView')}",
			data : { "distributor_info_id" : id , 'is_check' : is_check , 'desc' : desc , 'origin' : click_origin},
			success : function(data) {
				if (data["code"] > 0) {
					window.location.reload()
					showTip(data['message'],'success');
				}else{
					showTip(data['message'],'error');
				}
			}
		});
	}

	//下载身份证图片
	function downPic(){
		var data = {$apply};
		$.ajax({
			type : "post",
			url  : "{:__URL('ADMIN_MAIN/Distributor/downPic')}",
			data : {'img1' : data.id_face_pros , 'img2' : data.id_face_cons},
			success : function(data) {
				if (data["code"] > 0) {
					download(data['pic1']);
					download(data['pic2']);
					showTip(data['message'],'success');
				}else{
					showTip(data['message'],'error');
				}
			}
		});
	}

	//下载银行卡图片
	function downBankPic(){
		var data = {$apply};
		$.ajax({
			type : "post",
			url  : "{:__URL('ADMIN_MAIN/Distributor/downBankPic')}",
			data : {'bank_pic' : data.bank_card_pic},
			success : function(data) {
				if (data["code"] > 0) {
					download(data['bank_pic']);
					showTip(data['message'],'success');
				}else{
					showTip(data['message'],'error');
				}
			}
		});
	}

	//	图片下载 1
	function download(src) {
		var $a = document.createElement('a');
		$a.setAttribute("href", src);
		$a.setAttribute("download", "");

		var evObj = document.createEvent('MouseEvents');
		evObj.initMouseEvent( 'click', true, true, window, 0, 0, 0, 0, 0, false, false, true, false, 0, null);
		$a.dispatchEvent(evObj);
	}

	//	图片下载 2
	//判断是否为Trident内核浏览器(IE等)函数
	function browserIsIe() {
		if (!!window.ActiveXObject || "ActiveXObject" in window){
			return true;
		}
		else{
			return false;
		}
	}
	//创建iframe并赋值的函数,传入参数为图片的src属性值.
	function createIframe(imgSrc) {
		//如果隐藏的iframe不存在则创建
		if ($("#IframeReportImg").length === 0){
			$('<iframe style="display:none;" id="IframeReportImg" name="IframeReportImg" onload="downloadImg();" width="0" height="0" src="about:blank"></iframe>').appendTo("body");
		}
		//iframe的src属性如不指向图片地址,则手动修改,加载图片
		if ($('#IframeReportImg').attr("src") != imgSrc) {
			$('#IframeReportImg').attr("src",imgSrc);
		} else {
			//如指向图片地址,直接调用下载方法
			downloadImg();
		}
	}
	//下载图片的函数
	function downloadImg() {
		//iframe的src属性不为空,调用execCommand(),保存图片
		if ($('#IframeReportImg').src != "about:blank") {
			window.frames["IframeReportImg"].document.execCommand("SaveAs");
		}
	}
	//接下来进行事件绑定
	var aBtn = $("#down_btn_a");
	if (browserIsIe()) {
		//是ie等,绑定事件
		aBtn.on("click", function() {
//			var imgSrc = $(this).siblings("img").attr("src");
			var imgSrc = $('#img1').attr("src");

			//调用创建iframe的函数
			createIframe(imgSrc);
		});
	} else {
		aBtn.each(function(i,v){
			//支持download,添加属性.
//			var imgSrc = $(v).siblings("img").attr("src");
			var imgSrc = $('#img1').attr("src");

			$(v).attr("download",imgSrc);
			$(v).attr("href",imgSrc);
		})
	}

	//	导出数据
	function base64 (content) {
		return window.btoa(unescape(encodeURIComponent(content)));
	}
	function tableToExcel(tableID,tableID2,fileName){
		var table = document.getElementById(tableID);
		var table2 = document.getElementById(tableID2);
		var excelContent = table.innerHTML;
		var excelContent2 = table2.innerHTML;
		var excelFile = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:x='urn:schemas-microsoft-com:office:excel' xmlns='http://www.w3.org/TR/REC-html40'>";
		excelFile += "<head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head>";
		excelFile += "<body><table>";
		excelFile += excelContent;
		excelFile += excelContent2;
		excelFile += "</table></body>";
		excelFile += "</html>";
		var link = "data:application/vnd.ms-excel;base64," + base64(excelFile);
		var a = document.createElement("a");
		a.download = fileName+".xls";
		a.href = link;
		a.click();
	}

	var deg = 0;
	document.getElementById("bank_button").onclick = function () {
		deg += 90;
		document.getElementById("bank_img").style.transform = "rotate(" + deg + "deg)";
	};

	document.getElementById("icon_1_img").onclick = function () {
		deg += 90;
		document.getElementById("img1").style.transform = "rotate(" + deg + "deg)";
	};

	document.getElementById("icon_2_img").onclick = function () {
		deg += 90;
		document.getElementById("img2").style.transform = "rotate(" + deg + "deg)";
	}

	function updateIMG(){
		var data = {$apply};
		$.ajax({
			type : "post",
			url  : "{:__URL('ADMIN_MAIN/Distributor/updateIMG')}",
			data : {'uid' : data.uid},
			success : function(data) {
			}
		});
	}
</script>
{/block}